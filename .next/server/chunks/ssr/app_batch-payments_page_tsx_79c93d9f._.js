module.exports=[40148,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(46951);var e=a.i(23465),f=a.i(14432);let g={TESTNET:{RPC_URL:"https://soroban-testnet.stellar.org",HORIZON_URL:"https://horizon-testnet.stellar.org",NETWORK_PASSPHRASE:f.Networks.TESTNET,ORCHESTRATOR_CONTRACT:"CBYD7XCJH6RCA27AXXJDO3ARZHQJIW5BYEHAUKJ7QS6NQMLIQ2KMJ3K2",XLM_SAC:"CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC"},MAINNET:{RPC_URL:"https://soroban-rpc.stellar.org",HORIZON_URL:"https://horizon.stellar.org",NETWORK_PASSPHRASE:f.Networks.PUBLIC,ORCHESTRATOR_CONTRACT:"",XLM_SAC:"CAS3J7GYLGXMF6TDJBBYYSE3HQ6BBSMLNUQ34T6TZMYMW2EVH34XOWMA"}},h={worker1:"CA46744JXE6PUFP2E4G26QKBG3DTA3RIGGWGTP2QIEKZ6U3CQ3LKM7SH",worker2:"CAWHF5NQMVED6ANSUMG3OXEMWQHOX2K53VSOK5FO3MMMG7Y5YMFMZABZ",worker3:"CC6VG5BLTU4SIZQAFOQZOIOEKLQAR2NYTMPOLZVULK7ZHYUTE7YKORPJ",worker4:"CCOV6M4AEP7TGZ3NIMFGUXMWO3TXSWHSHDGGMIYNN7QM2COM7ITEJBMU",worker5:"CDWIM6L5FKT3PQ7PCM5UFUIWPS22YVQWUMIMPKLPKBVFUKD5JJUQNH27",worker6:"CD236CW2YLUXXWK4WT6BRDKMDDCKZKPU5RJRSVL64H6XZLXEU3UZ73GF",worker7:"CB7O7WGBXMVGES75LSLVC277YIHVHGO75RN7YJELE7IQ2664TMZ4OLG6",worker8:"CBAUCRBOPXN33TIUIMBCQ2BPWPA446IWMK32KYO43RGOLG3KPBE3L5J2",worker9:"CCM6WJHG6CDN7YCR4BVSFKJVQEOW5BA6IHH6RSXX5QRPLNS7E4UL4SLN",worker10:"CBHRLC3IY6OIOGTU4E737IKPWV46N43NLTJX2ZIYGK7ZI6B4TRL7HIIC",worker11:"CC6N434Q5GH4TIN4NVXK7FWZHLEAAC3MIZATRHT3YK2VEAVK3GKW62CE",worker12:"CBGMTVKUULAVZ3UJQMJ74SISODP5FV5W2UGSWXHYGXUAYGLMXTM3QKHH",worker13:"CBCWTKVJEVDNYLMK7PD5VU67IX46BPCSOH75EINCF4MIYJW7HUF2O7P6",worker14:"CCNZ753NQBP67AZSYCQNLCVW56ZAY36AQMTNOBI2WKLP4GNR5ARBRIES",worker15:"CAEPOYMB33T6MQXNA2C5HLXNCKHLC5RCMF7EFCMPB3M2764RRUACC2E6",worker16:"CCJYOSKABCA4XDATIPB4BJI63GQ25AMGXFQSY6KSZ3AMCWAD6OF4L3RW",worker17:"CBEJCOJBK5QWHSOPLZY6OGY2446JXC5UJG2565NAQNP2BBY3WSRWZD57",worker18:"CB2TXKCIFCITSG4QICQAWJ4GPVJ6YBVBKBPTEAA5IDHL2QKHZ7FCLGNK",worker19:"CCTMP2VNVVSABI7J2L442KTBLRHYAMVIB632UTBZYZDMV3RIGU4OUBBY",worker20:"CBFYQMR7BY7CANCIWJEAL7LYVURWUIKZZZFM3FR2B765HZKTGYLEYLWW"};class i{server;networkPassphrase;orchestratorContract;xlmSac;workerContracts;constructor(a="testnet"){const b="mainnet"===a?g.MAINNET:g.TESTNET;this.server=new f.rpc.Server(b.RPC_URL,{allowHttp:!0}),this.networkPassphrase=b.NETWORK_PASSPHRASE,this.orchestratorContract=b.ORCHESTRATOR_CONTRACT,this.xlmSac=b.XLM_SAC,this.workerContracts=Object.values(h)}validateAndCreateBatches(a){if(0===a.length)return{error:"No recipients provided"};if(a.length>80)return{error:`Maximum 80 recipients per transaction. You provided ${a.length}.`};for(let b=0;b<a.length;b++){let c=a[b];if(!c.address||56!==c.address.length||!c.address.startsWith("G"))return{error:`Invalid Stellar address at row ${b+1}: ${c.address}`};if(c.amount<=0n)return{error:`Amount must be positive at row ${b+1}`}}let b=[],c=[];for(let d=0;d<a.length;d+=19){let e=a.slice(d,d+19),f=b.length%this.workerContracts.length;b.push({workerContractId:this.workerContracts[f],recipients:e.map(a=>a.address),amounts:e.map(a=>a.amount)}),c.push(e.length)}let d=a.reduce((a,b)=>a+b.amount,0n);return{batches:b,stats:{totalRecipients:a.length,totalAmount:d,batchCount:b.length,recipientsPerBatch:c}}}async buildAuthTree(a,b){let c=(await this.server.getLatestLedger()).sequence,d=c+1e3,e=BigInt(c),g=b.map(b=>{let c=b.recipients.map((c,d)=>new f.xdr.SorobanAuthorizedInvocation({function:f.xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(new f.xdr.InvokeContractArgs({contractAddress:new f.Address(this.xlmSac).toScAddress(),functionName:"transfer",args:[new f.Address(a).toScVal(),new f.Address(c).toScVal(),(0,f.nativeToScVal)(b.amounts[d],{type:"i128"})]})),subInvocations:[]}));return new f.xdr.SorobanAuthorizedInvocation({function:f.xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(new f.xdr.InvokeContractArgs({contractAddress:new f.Address(b.workerContractId).toScAddress(),functionName:"batch_pay",args:[new f.Address(a).toScVal(),f.xdr.ScVal.scvVec(b.recipients.map(a=>new f.Address(a).toScVal())),f.xdr.ScVal.scvVec(b.amounts.map(a=>(0,f.nativeToScVal)(a,{type:"i128"}))),new f.Address(this.xlmSac).toScVal()]})),subInvocations:c})}),h=f.xdr.ScVal.scvVec(b.map(a=>f.xdr.ScVal.scvMap([new f.xdr.ScMapEntry({key:f.xdr.ScVal.scvSymbol("amounts"),val:f.xdr.ScVal.scvVec(a.amounts.map(a=>(0,f.nativeToScVal)(a,{type:"i128"})))}),new f.xdr.ScMapEntry({key:f.xdr.ScVal.scvSymbol("recipients"),val:f.xdr.ScVal.scvVec(a.recipients.map(a=>new f.Address(a).toScVal()))}),new f.xdr.ScMapEntry({key:f.xdr.ScVal.scvSymbol("worker_contract"),val:new f.Address(a.workerContractId).toScVal()})]))),i=new f.xdr.SorobanAuthorizedInvocation({function:f.xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(new f.xdr.InvokeContractArgs({contractAddress:new f.Address(this.orchestratorContract).toScAddress(),functionName:"orchestrate_payments",args:[new f.Address(a).toScVal(),h,new f.Address(this.xlmSac).toScVal()]})),subInvocations:g}),j=new f.xdr.SorobanAuthorizationEntry({credentials:f.xdr.SorobanCredentials.sorobanCredentialsAddress(new f.xdr.SorobanAddressCredentials({address:new f.Address(a).toScAddress(),nonce:f.xdr.Int64.fromString(e.toString()),signatureExpirationLedger:d,signature:f.xdr.ScVal.scvVoid()})),rootInvocation:i}),k=(0,f.hash)(Buffer.from(this.networkPassphrase)),l=f.xdr.HashIdPreimage.envelopeTypeSorobanAuthorization(new f.xdr.HashIdPreimageSorobanAuthorization({networkId:k,nonce:f.xdr.Int64.fromString(e.toString()),signatureExpirationLedger:d,invocation:i})).toXDR(),m=l.toString("base64");return{authEntry:j,authPayload:(0,f.hash)(l),authPreimageXdr:m,expirationLedger:d,nonce:e}}async signAuthEntry(a,b,c,d){let e=await c(d),g=f.xdr.ScVal.scvVec([f.xdr.ScVal.scvMap([new f.xdr.ScMapEntry({key:f.xdr.ScVal.scvSymbol("public_key"),val:f.xdr.ScVal.scvBytes(f.Keypair.fromPublicKey(b).rawPublicKey())}),new f.xdr.ScMapEntry({key:f.xdr.ScVal.scvSymbol("signature"),val:f.xdr.ScVal.scvBytes(e)})])]),h=a.credentials().address(),i=f.xdr.SorobanCredentials.sorobanCredentialsAddress(new f.xdr.SorobanAddressCredentials({address:h.address(),nonce:h.nonce(),signatureExpirationLedger:h.signatureExpirationLedger(),signature:g}));return new f.xdr.SorobanAuthorizationEntry({credentials:i,rootInvocation:a.rootInvocation()})}async submitTransaction(a,b){let c,d=f.Keypair.fromSecret(b),e=d.publicKey();console.log("=== Submit Transaction Debug ==="),console.log("Service address:",e),console.log("Orchestrator contract:",this.orchestratorContract),console.log("XLM SAC:",this.xlmSac);try{c=await this.server.getAccount(e)}catch(a){return{success:!1,error:`Failed to load service account: ${e}. Ensure it is funded.`}}let g=a.rootInvocation().function().contractFn(),h=f.xdr.HostFunction.hostFunctionTypeInvokeContract(g),i=f.Operation.invokeHostFunction({func:h,auth:[a]}),j=new f.TransactionBuilder(c,{fee:"100",networkPassphrase:this.networkPassphrase}).addOperation(i).setTimeout(60).build(),k=await this.server.simulateTransaction(j);if(f.rpc.Api.isSimulationError(k)){console.error("=== Simulation Error ==="),console.error("Error:",k.error),console.error("Full response:",JSON.stringify(k,null,2));let a=k.error||"Unknown simulation error";return{success:!1,error:`Simulation failed: ${a}`}}let l=k.transactionData?.build(),m=Math.ceil(2*parseInt(k.minResourceFee||"0"));c=await this.server.getAccount(e);let n=new f.TransactionBuilder(c,{fee:m.toString(),networkPassphrase:this.networkPassphrase}).setSorobanData(l).addOperation(i).setTimeout(90).build();n.sign(d);let o=await this.server.sendTransaction(n);if("PENDING"!==o.status)return{success:!1,error:`Transaction submission failed. Status: ${o.status}`};let p=await this.server.getTransaction(o.hash),q=0;for(;"NOT_FOUND"===p.status&&q<30;)await new Promise(a=>setTimeout(a,1e3)),p=await this.server.getTransaction(o.hash),q++;return"SUCCESS"===p.status?{success:!0,hash:o.hash,ledger:p.ledger}:{success:!1,error:`Transaction failed with status: ${p.status}`,hash:o.hash}}async checkAccountExists(a){try{return await this.server.getAccount(a),{exists:!0}}catch(b){if(b.message?.includes("Not Found")||404===b.code)return{exists:!1,error:`Account ${a} does not exist on the network. Please fund it first.`};return{exists:!1,error:b.message||"An unknown error occurred while checking account existence."}}}static xlmToStroops(a){return BigInt(Math.floor(("string"==typeof a?parseFloat(a):a)*Number(10000000n)))}static stroopsToXlm(a){return(Number(a)/Number(10000000n)).toFixed(7)}static parseCSV(a){let b=a.trim().split("\n"),c=[],d=[],e=0,f=b[0].toLowerCase();(f.includes("address")||f.includes("recipient")||f.includes("amount"))&&(e=1);for(let a=e;a<b.length;a++){let e=b[a].trim();if(!e)continue;let f=e.split(",").map(a=>a.trim());if(f.length<2)return{error:`Invalid format at line ${a+1}: expected "address,amount"`};let g=f[0],h=f[1],j=parseFloat(h);if(isNaN(j)||j<=0)return{error:`Invalid amount at line ${a+1}: ${h}`};j<1e-7&&d.push(`Very small amount at line ${a+1}: ${h} XLM`),c.push({address:g,amount:i.xlmToStroops(j)})}return 0===c.length?{error:"No valid recipients found in CSV"}:{recipients:c,warnings:d}}getOrchestratorContract(){return this.orchestratorContract}getXlmSac(){return this.xlmSac}getServer(){return this.server}}function j({recipients:a,onRecipientsChange:d,disabled:e=!1}){let[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)("manual"),j=(0,c.useRef)(null),k=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l=(a,b)=>{if(!a.trim())return{isValid:!1,error:"Address required"};if(56!==a.length||!a.startsWith("G"))return{isValid:!1,error:"Invalid Stellar address"};let c=parseFloat(b);return isNaN(c)||c<=0?{isValid:!1,error:"Invalid amount"}:{isValid:!0}},m=(b,c,e)=>{d(a.map(a=>{if(a.id!==b)return a;let d=l("address"===c?e:a.address,"amount"===c?e:a.amount);return{...a,[c]:e,isValid:d.isValid,error:d.error}}))},n=(0,c.useCallback)(a=>{let b=new FileReader;b.onload=a=>{let b=(a.target?.result).trim().split("\n"),c=0,e=b[0].toLowerCase();(e.includes("address")||e.includes("recipient"))&&(c=1);let f=[];for(let a=c;a<b.length&&f.length<80;a++){let c=b[a].trim();if(!c)continue;let d=c.split(",").map(a=>a.trim());if(d.length>=2){let a=d[0],b=d[1],c=l(a,b);f.push({id:k(),address:a,amount:b,isValid:c.isValid,error:c.error})}}f.length>0&&(d(f),i("csv"))},b.readAsText(a)},[d]),o=a=>{a.preventDefault(),a.stopPropagation(),"dragenter"===a.type||"dragover"===a.type?g(!0):"dragleave"===a.type&&g(!1)},p=a.filter(a=>a.isValid).length,q=a.filter(a=>a.isValid).reduce((a,b)=>a+parseFloat(b.amount),0);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("div",{className:"flex bg-white/5 rounded-lg p-1",children:[(0,b.jsx)("button",{onClick:()=>i("manual"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${"manual"===h?"bg-white/10 text-white":"text-white/50 hover:text-white"}`,disabled:e,children:"Manual Entry"}),(0,b.jsx)("button",{onClick:()=>j.current?.click(),className:`px-3 py-1.5 text-sm rounded-md transition-all ${"csv"===h?"bg-white/10 text-white":"text-white/50 hover:text-white"}`,disabled:e,children:"Upload CSV"})]})}),(0,b.jsxs)("div",{className:"text-sm text-white/50",children:[p,"/",80," recipients"]})]}),(0,b.jsxs)("div",{className:`relative border-2 border-dashed rounded-xl p-6 text-center transition-all ${f?"border-blue-500 bg-blue-500/10":"border-white/20 hover:border-white/30"} ${e?"opacity-50 pointer-events-none":""}`,onDragEnter:o,onDragLeave:o,onDragOver:o,onDrop:a=>{a.preventDefault(),a.stopPropagation(),g(!1),a.dataTransfer.files&&a.dataTransfer.files[0]&&n(a.dataTransfer.files[0])},children:[(0,b.jsx)("input",{ref:j,type:"file",accept:".csv,.txt",onChange:a=>a.target.files?.[0]&&n(a.target.files[0]),className:"hidden",disabled:e}),(0,b.jsx)("svg",{className:"w-10 h-10 mx-auto mb-3 text-white/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,b.jsxs)("p",{className:"text-sm text-white/60 mb-1",children:["Drag and drop CSV file here, or"," ",(0,b.jsx)("button",{onClick:()=>j.current?.click(),className:"text-blue-400 hover:text-blue-300",disabled:e,children:"browse"})]}),(0,b.jsx)("p",{className:"text-xs text-white/40",children:"Format: address,amount (amount in XLM)"})]}),(0,b.jsxs)("div",{className:"bg-black/20 rounded-xl border border-white/10 overflow-hidden",children:[(0,b.jsxs)("div",{className:"grid grid-cols-[1fr_120px_40px] gap-2 px-4 py-3 bg-white/5 border-b border-white/10",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-white/60 uppercase tracking-wider",children:"Recipient Address"}),(0,b.jsx)("div",{className:"text-xs font-medium text-white/60 uppercase tracking-wider",children:"Amount (XLM)"}),(0,b.jsx)("div",{})]}),(0,b.jsx)("div",{className:"max-h-[320px] overflow-y-auto",children:a.map((c,f)=>(0,b.jsxs)("div",{className:`grid grid-cols-[1fr_120px_40px] gap-2 px-4 py-2 border-b border-white/5 ${!c.isValid&&(c.address||c.amount)?"bg-red-500/5":""}`,children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{type:"text",value:c.address,onChange:a=>m(c.id,"address",a.target.value),placeholder:"G...",className:`w-full bg-transparent border-0 text-sm font-mono text-white placeholder-white/30 focus:outline-none focus:ring-0 ${!c.isValid&&c.address?"text-red-400":""}`,disabled:e}),c.error&&c.address&&(0,b.jsx)("div",{className:"absolute -bottom-4 left-0 text-xs text-red-400",children:c.error})]}),(0,b.jsx)("input",{type:"number",step:"0.0000001",min:"0",value:c.amount,onChange:a=>m(c.id,"amount",a.target.value),placeholder:"0.00",className:"w-full bg-transparent border-0 text-sm text-white placeholder-white/30 focus:outline-none focus:ring-0",disabled:e}),(0,b.jsx)("button",{onClick:()=>{var b;return b=c.id,void(!(a.length<=1)&&d(a.filter(a=>a.id!==b)))},className:"flex items-center justify-center text-white/30 hover:text-red-400 transition-colors",disabled:e||a.length<=1,children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},c.id))}),(0,b.jsx)("div",{className:"px-4 py-3 border-t border-white/10",children:(0,b.jsxs)("button",{onClick:()=>{a.length>=80||d([...a,{id:k(),address:"",amount:"",isValid:!1}])},disabled:e||a.length>=80,className:"flex items-center gap-2 text-sm text-white/50 hover:text-white transition-colors disabled:opacity-30",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Recipient"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 p-4 bg-white/5 rounded-xl",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-white/40 mb-1",children:"Valid Recipients"}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-white",children:[p,(0,b.jsxs)("span",{className:"text-sm text-white/40",children:["/",a.length]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-white/40 mb-1",children:"Total Amount"}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-white",children:[q.toFixed(2),(0,b.jsx)("span",{className:"text-sm text-white/40",children:" XLM"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-white/40 mb-1",children:"Batches"}),(0,b.jsx)("div",{className:"text-lg font-semibold text-white",children:Math.ceil(p/19)||0})]})]}),a.length>=80&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,b.jsxs)("span",{className:"text-sm text-yellow-200",children:["Approaching limit: Maximum ",80," recipients per transaction"]})]}),a.length>1&&(0,b.jsx)("button",{onClick:()=>{d([{id:k(),address:"",amount:"",isValid:!1}]),i("manual")},disabled:e,className:"text-sm text-white/40 hover:text-white transition-colors",children:"Clear all recipients"})]})}function k(a){return 1-Math.pow(1-a,3)}function l({batches:a,isProcessing:d,isComplete:e,transactionHash:f,transactionState:g="idle",onVisualizationComplete:h}){let[i,j]=(0,c.useState)(0),[l,n]=(0,c.useState)("idle"),[o,p]=(0,c.useState)(!1),q=(0,c.useRef)(null),r=(0,c.useRef)(null),s=(0,c.useRef)(null),t=(0,c.useRef)(0),u=(0,c.useRef)("idle");a.map((a,b)=>{let c=Array.from({length:a.recipientCount},(a,c)=>({id:`transfer-${b}-${c}`,label:`Transfer ${c+1}`,type:"transfer",status:"pending"}));return{id:`worker-${b}`,label:`Worker ${b+1}`,type:"worker",children:c,status:"pending"}});let v=1+a.length+a.reduce((a,b)=>a+b.recipientCount,0),w=(0,c.useCallback)(a=>{switch(a){case"preparing":return{min:0,max:.3};case"signing":return{min:.3,max:.5};case"submitting":return{min:.5,max:.85};case"success":return{min:.85,max:1};default:return{min:0,max:0}}},[]),x=(0,c.useCallback)(()=>{if(!r.current)return;let a=Date.now()-r.current,b=w(g),c=Math.min(a/800,1),d=b.min+(b.max-b.min)*.9,f=b.min+(d-b.min)*k(c);j(a=>Math.max(a,f)),f<.3?n("building"):f<.5?n("signing"):f<.85&&n("submitting"),c<1&&!e&&(q.current=requestAnimationFrame(x))},[g,e,w]),y=(0,c.useCallback)(()=>{if(!s.current)return;let a=Math.min((Date.now()-s.current)/2e3,1),b=t.current,c=b+(1-b)*k(a);j(c),c<.95?n("submitting"):n("complete"),a<1?q.current=requestAnimationFrame(y):(p(!0),h?.())},[h]);(0,c.useEffect)(()=>(q.current&&(cancelAnimationFrame(q.current),q.current=null),g!==u.current&&(u.current=g,"preparing"===g?(r.current=Date.now(),n("building"),q.current=requestAnimationFrame(x)):"signing"===g?(r.current=Date.now(),n("signing"),j(a=>Math.max(a,.3)),q.current=requestAnimationFrame(x)):"submitting"===g?(r.current=Date.now(),n("submitting"),j(a=>Math.max(a,.5)),q.current=requestAnimationFrame(x)):"success"===g?(t.current=i,s.current=Date.now(),q.current=requestAnimationFrame(y)):"error"===g?n("idle"):"idle"===g&&(r.current=null,s.current=null,t.current=0,j(0),n("idle"),p(!1))),()=>{q.current&&cancelAnimationFrame(q.current)}),[g,x,y,i]),(0,c.useEffect)(()=>{e&&"success"!==g&&!s.current&&(t.current=i,s.current=Date.now(),q.current=requestAnimationFrame(y))},[e,g,i,y]),(0,c.useEffect)(()=>{d||e||"idle"!==g||(r.current=null,s.current=null,t.current=0,j(0),n("idle"),p(!1))},[d,e,g]);let z=(a,b)=>{if(o||i>=.99)return"complete";let c=b/v;return i>=c+1/v?"complete":i>=c?"active":"pending"};return(0,b.jsxs)("div",{className:"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Authorization Tree"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["idle"!==l&&"complete"!==l&&(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500 animate-pulse"}),"complete"===l&&(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,b.jsx)("span",{className:"text-sm text-white/60",children:{idle:"Ready to process",building:"Building Authorization Tree...",signing:"Awaiting Signature...",submitting:"Submitting Transaction...",complete:"Transaction Complete"}[l]})]})]}),"idle"!==l&&(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)("div",{className:"h-1 bg-white/10 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 ease-out",style:{width:`${100*i}%`}})})}),(0,b.jsx)("div",{className:"relative",children:(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)(m,{label:"Orchestrator",sublabel:"orchestrate_payments()",status:z(0,1),isRoot:!0}),a.length>0&&(0,b.jsxs)("div",{className:"relative w-full mt-4 mb-4",children:[(0,b.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-px h-6 bg-white/20"}),(0,b.jsx)("div",{className:"absolute top-6 left-1/2 transform -translate-x-1/2 w-[80%] h-px bg-white/20"})]}),(0,b.jsx)("div",{className:"flex flex-wrap justify-center gap-4 w-full",children:a.map((c,d)=>{let e=1+d*(1+Math.max(...a.map(a=>a.recipientCount))),f=z(d+1,e/v);return(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"w-px h-4 bg-white/20"}),(0,b.jsx)(m,{label:`Worker ${d+1}`,sublabel:`batch_pay() - ${c.recipientCount} transfers`,status:f}),(0,b.jsx)("div",{className:"mt-3 flex flex-wrap justify-center gap-1 max-w-[120px]",children:Array.from({length:c.recipientCount},(a,c)=>{let d=e+1+c,f=z(d,d/v);return(0,b.jsx)("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${"complete"===f?"bg-green-500":"active"===f?"bg-blue-500 animate-pulse":"bg-white/20"}`,title:`Transfer ${c+1}`},c)})})]},d)})})]})}),(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10 grid grid-cols-3 gap-4 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-semibold text-white",children:a.length}),(0,b.jsx)("div",{className:"text-xs text-white/40",children:"Batches"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-semibold text-white",children:a.reduce((a,b)=>a+b.recipientCount,0)}),(0,b.jsx)("div",{className:"text-xs text-white/40",children:"Recipients"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-semibold text-white",children:"1"}),(0,b.jsx)("div",{className:"text-xs text-white/40",children:"Signature"})]})]}),f&&"complete"===l&&(0,b.jsxs)("div",{className:"mt-4 p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[(0,b.jsx)("div",{className:"text-xs text-green-400 mb-1",children:"Transaction Hash"}),(0,b.jsx)("div",{className:"text-sm text-white font-mono truncate",children:(0,b.jsx)("a",{href:`https://stellar.expert/explorer/testnet/tx/${f}`,target:"_blank",rel:"noopener noreferrer",className:"hover:text-blue-400 transition-colors",children:f})})]})]})}function m({label:a,sublabel:c,status:d,isRoot:e}){return(0,b.jsx)("div",{className:`relative px-4 py-3 rounded-xl border transition-all duration-300 ${{pending:"border-white/20 bg-black/40",active:"border-blue-500 bg-blue-500/10 shadow-lg shadow-blue-500/20",complete:"border-green-500 bg-green-500/10"}[d]} ${e?"min-w-[200px]":"min-w-[140px]"}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`transition-colors duration-300 ${{pending:"text-white/40",active:"text-blue-400",complete:"text-green-400"}[d]}`,children:"complete"===d?(0,b.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):"active"===d?(0,b.jsxs)("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,b.jsx)("div",{className:"w-4 h-4 rounded-full border border-current"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium text-white",children:a}),c&&(0,b.jsx)("div",{className:"text-xs text-white/40 font-mono",children:c})]})]})})}new i("testnet");var n=a.i(68936),o=a.i(59127);function p(){let a=(0,d.useRouter)(),{walletState:f,signAuthEntry:g,formatAddress:h,isTestnet:k}=(0,n.useWallet)(),[m,p]=(0,c.useState)([{id:"1",address:"",amount:"",isValid:!1}]),[q,r]=(0,c.useState)({state:"idle",message:"Ready to process payments"}),[s,t]=(0,c.useState)(!1),u=(0,c.useCallback)(()=>{t(!0)},[]),v=(0,c.useMemo)(()=>m.filter(a=>a.isValid),[m]),w=(0,c.useMemo)(()=>{let a=v.length;if(0===a)return[];let b=[];for(let c=0;c<a;c+=19)b.push({workerIndex:b.length,recipientCount:Math.min(19,a-c)});return b},[v]),x=(0,c.useMemo)(()=>v.reduce((a,b)=>a+parseFloat(b.amount),0),[v]),y=async()=>{if(t(!1),0===v.length)return void r({state:"error",message:"No valid recipients",error:"Add at least one valid recipient"});if(!f.isConnected||!f.address)return void r({state:"error",message:"Wallet not connected",error:"Please connect your Freighter wallet first"});if(!k())return void r({state:"error",message:"Wrong network",error:"Please switch to Stellar Testnet in Freighter"});try{r({state:"preparing",message:"Building authorization tree..."});let a=new i("testnet");if(!(await a.checkAccountExists(f.address)).exists)return void r({state:"error",message:"Account not funded",error:(0,b.jsxs)("span",{children:["Your wallet address does not exist on Stellar Testnet. Please fund it using the Stellar"," ",(0,b.jsx)("a",{href:`https://friendbot.stellar.org?addr=${f.address}`,target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-blue-300",children:"Friendbot"}),"."]})});let c=v.map(a=>({address:a.address,amount:i.xlmToStroops(a.amount)})),d=a.validateAndCreateBatches(c);if(d.error||!d.batches)return void r({state:"error",message:"Validation failed",error:d.error||"Failed to create batches"});let e=await a.buildAuthTree(f.address,d.batches);r({state:"signing",message:"Awaiting wallet signature..."});let h=await g(e.authPreimageXdr);if((0,o.isWalletError)(h))return void(h.code===o.WalletErrorCode.USER_REJECTED?r({state:"error",message:"Signing cancelled",error:"You cancelled the signing request"}):r({state:"error",message:"Signing failed",error:h.message}));r({state:"submitting",message:"Attaching signature and submitting..."});let j=atob(h.signedAuthEntry),k=new Uint8Array(j.length);for(let a=0;a<j.length;a++)k[a]=j.charCodeAt(a);let l=Buffer.from(k),m=await a.signAuthEntry(e.authEntry,f.address,async()=>l,e.authPayload),n=await a.submitTransaction(m,"SDLLCGN5DWJGMRQTNIP5LKUIZNIIGK47C45MARZG5KD5A6D63V4WGFTR");n.success?r({state:"success",message:`Payment successful! ${d.stats?.totalRecipients} recipients paid.`,hash:n.hash}):r({state:"error",message:"Transaction failed",error:n.error||"Unknown error during submission"})}catch(a){console.error("Batch payment error:",a),r({state:"error",message:"Transaction failed",error:a.message||"Unknown error occurred"})}},z=["preparing","signing","submitting"].includes(q.state),A=z||"success"===q.state,B=v.length>0&&f.isConnected&&!A;return(0,b.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,b.jsxs)("nav",{className:"w-full flex items-center justify-between py-6 px-8 lg:px-16 fixed top-0 left-0 z-50 bg-black/80 backdrop-blur-lg border-b border-white/5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,b.jsxs)("button",{onClick:()=>a.push("/dashboard"),className:"flex items-center gap-2 text-white/60 hover:text-white transition-colors",children:[(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,b.jsx)("div",{className:"w-px h-6 bg-white/20"}),(0,b.jsxs)("a",{href:"/",className:"text-white/80 hover:text-white transition-colors flex items-center",children:[(0,b.jsx)("img",{src:"/Tess_BW.svg",alt:"Tesseract",className:"h-7 w-7 inline-block mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"TESSERACT"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(n.NetworkBadge,{}),(0,b.jsx)(n.ConnectWalletButton,{})]})]}),(0,b.jsxs)("div",{className:"pt-24 pb-12 px-8 lg:px-16",children:[(0,b.jsxs)("div",{className:"max-w-6xl mx-auto mb-8",children:[(0,b.jsx)("h1",{className:`text-3xl lg:text-4xl font-bold mb-2 ${e.lexendTera.className}`,children:"Batch Payments"}),(0,b.jsxs)("p",{className:"text-white/60",children:["Pay up to ",80," recipients with a single signature"]})]}),!f.isInstalled&&(0,b.jsx)("div",{className:"max-w-6xl mx-auto mb-8 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("svg",{className:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-yellow-200 font-medium",children:"Freighter Wallet Required"}),(0,b.jsxs)("p",{className:"text-yellow-200/70 text-sm",children:["Install the"," ",(0,b.jsx)("a",{href:"https://freighter.app",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-yellow-100",children:"Freighter browser extension"})," ","to use batch payments."]})]})]})}),(0,b.jsxs)("div",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Recipients"}),(0,b.jsx)(j,{recipients:m,onRecipientsChange:p,disabled:A})]}),v.length>0&&(0,b.jsxs)("div",{className:"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Payment Summary"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-white/60",children:"Recipients"}),(0,b.jsx)("span",{className:"font-medium",children:v.length})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-white/60",children:"Batches"}),(0,b.jsx)("span",{className:"font-medium",children:w.length})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-white/60",children:"Total Amount"}),(0,b.jsxs)("span",{className:"font-medium",children:[x.toFixed(7)," XLM"]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-white/60",children:"Signatures Required"}),(0,b.jsx)("span",{className:"font-medium text-green-400",children:"1"})]}),(0,b.jsx)("div",{className:"h-px bg-white/10"}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-white/60",children:"Estimated Fee"}),(0,b.jsx)("span",{className:"font-medium text-white/80",children:"~0.01 XLM"})]}),f.address&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"h-px bg-white/10"}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-white/60",children:"From"}),(0,b.jsx)("span",{className:"font-mono text-sm text-white/80",children:h(f.address)})]})]})]})]}),(0,b.jsx)("button",{onClick:y,disabled:!B,className:`w-full py-4 rounded-xl font-medium text-lg transition-all ${B?"bg-gradient-to-r from-blue-500 to-purple-500 text-white hover:opacity-90":"bg-white/10 text-white/40 cursor-not-allowed"}`,children:A?(0,b.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,b.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"success"===q.state?"Completing...":q.message]}):f.isConnected?0===v.length?"Add Recipients to Continue":`Pay ${v.length} Recipients`:"Connect Wallet to Continue"}),"idle"!==q.state&&(0,b.jsxs)("div",{className:`p-4 rounded-xl border ${"error"===q.state?"bg-red-500/10 border-red-500/20":"success"===q.state?"bg-green-500/10 border-green-500/20":"bg-blue-500/10 border-blue-500/20"}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["success"===q.state&&(0,b.jsx)("svg",{className:"w-5 h-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"error"===q.state&&(0,b.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,b.jsx)("span",{className:"error"===q.state?"text-red-400":"success"===q.state?"text-green-400":"text-blue-400",children:q.message})]}),q.error&&(0,b.jsx)("p",{className:"mt-2 text-sm text-white/50",children:q.error}),q.hash&&"success"===q.state&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("a",{href:`https://stellar.expert/explorer/testnet/tx/${q.hash}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-400 hover:text-blue-300 font-mono break-all",children:"View on Stellar Expert â†’"}),(0,b.jsxs)("p",{className:"text-xs text-white/40 mt-2 font-mono",children:["TX: ",q.hash]})]}),("error"===q.state||"success"===q.state)&&(0,b.jsx)("button",{onClick:()=>{r({state:"idle",message:"Ready to process payments"}),t(!1)},className:"mt-3 text-sm text-white/50 hover:text-white",children:"success"===q.state?"New Payment":"Try Again"})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(l,{batches:w,isProcessing:z,isComplete:"success"===q.state,transactionHash:q.hash,transactionState:q.state,onVisualizationComplete:u}),(0,b.jsxs)("div",{className:"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"How It Works"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs text-blue-400",children:"1"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:"Add Recipients"}),(0,b.jsxs)("div",{className:"text-xs text-white/50",children:["Upload a CSV or manually enter up to ",80," recipients"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs text-blue-400",children:"2"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:"Build Auth Tree"}),(0,b.jsxs)("div",{className:"text-xs text-white/50",children:["Recipients are split into batches of ",19," for optimal processing"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs text-blue-400",children:"3"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:"Sign with Freighter"}),(0,b.jsx)("div",{className:"text-xs text-white/50",children:"One signature authorizes all payments atomically"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center text-xs text-green-400",children:"4"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:"Execute"}),(0,b.jsx)("div",{className:"text-xs text-white/50",children:"All payments succeed or fail together in one transaction"})]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white/5 rounded-xl p-4",children:[(0,b.jsx)("h4",{className:"text-sm font-medium mb-3",children:"Current Limits"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-white/50",children:"Max Recipients"}),(0,b.jsx)("span",{children:80})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-white/50",children:"Per Batch"}),(0,b.jsx)("span",{children:19})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-white/50",children:"Max Batches"}),(0,b.jsx)("span",{children:5})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-white/50",children:"Network"}),(0,b.jsx)("span",{className:"text-yellow-400",children:"Testnet"})]})]})]})]})]})]}),(0,b.jsx)("footer",{className:"border-t border-white/10 py-6 px-8 lg:px-16",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto flex items-center justify-between text-sm text-white/40",children:[(0,b.jsx)("span",{children:"Powered by Stellar Soroban"}),(0,b.jsx)("span",{children:"Tesseract - 4D Privacy on 2D Ledger"})]})})]})}function q(){return(0,b.jsx)(n.WalletProvider,{children:(0,b.jsx)(p,{})})}a.s(["default",()=>q],40148)}];

//# sourceMappingURL=app_batch-payments_page_tsx_79c93d9f._.js.map