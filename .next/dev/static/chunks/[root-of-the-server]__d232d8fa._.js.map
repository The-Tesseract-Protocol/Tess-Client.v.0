{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[next]/internal/font/google/lexend_tera_c343b42e.module.css [app-client] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"className\": \"lexend_tera_c343b42e-module__33zOOW__className\",\n  \"variable\": \"lexend_tera_c343b42e-module__33zOOW__variable\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 11, "column": 0}, "map": {"version":3,"sources":["turbopack:///[next]/internal/font/google/lexend_tera_c343b42e.js"],"sourcesContent":["import cssModule from \"@vercel/turbopack-next/internal/font/google/cssmodule.module.css?{%22path%22:%22Fonts.ts%22,%22import%22:%22Lexend_Tera%22,%22arguments%22:[{%22subsets%22:[%22latin%22],%22weight%22:[%22400%22,%22700%22],%22variable%22:%22--font-lexend-tera%22}],%22variableName%22:%22lexendTera%22}\";\nconst fontData = {\n    className: cssModule.className,\n    style: {\n        fontFamily: \"'Lexend Tera', 'Lexend Tera Fallback'\",\n        fontStyle: \"normal\",\n\n    },\n};\n\nif (cssModule.variable != null) {\n    fontData.variable = cssModule.variable;\n}\n\nexport default fontData;\n"],"names":[],"mappings":";;;;AAAA;;AACA,MAAM,WAAW;IACb,WAAW,yKAAS,CAAC,SAAS;IAC9B,OAAO;QACH,YAAY;QACZ,WAAW;IAEf;AACJ;AAEA,IAAI,yKAAS,CAAC,QAAQ,IAAI,MAAM;IAC5B,SAAS,QAAQ,GAAG,yKAAS,CAAC,QAAQ;AAC1C;uCAEe","ignoreList":[0]}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushalchaudhari/Desktop/Tesseract-Client/tesseract-client/app/services/bulkPaymentService.ts"],"sourcesContent":["import {\n    Address,\n    Keypair,\n    Operation,\n    rpc,\n    TransactionBuilder,\n    xdr,\n    nativeToScVal,\n    hash,\n    Account,\n    Networks,\n} from '@stellar/stellar-sdk';\n\n// ==================== CONFIGURATION ====================\n\nconst CONFIG = {\n    TESTNET: {\n        RPC_URL: 'https://soroban-testnet.stellar.org',\n        HORIZON_URL: 'https://horizon-testnet.stellar.org',\n        NETWORK_PASSPHRASE: Networks.TESTNET,\n        ORCHESTRATOR_CONTRACT: 'CBYD7XCJH6RCA27AXXJDO3ARZHQJIW5BYEHAUKJ7QS6NQMLIQ2KMJ3K2',\n        XLM_SAC: 'CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC',\n    },\n    MAINNET: {\n        RPC_URL: 'https://soroban-rpc.stellar.org',\n        HORIZON_URL: 'https://horizon.stellar.org',\n        NETWORK_PASSPHRASE: Networks.PUBLIC,\n        ORCHESTRATOR_CONTRACT: '', // TODO: Deploy and update for mainnet\n        XLM_SAC: 'CAS3J7GYLGXMF6TDJBBYYSE3HQ6BBSMLNUQ34T6TZMYMW2EVH34XOWMA',\n    },\n};\n\n// Worker contracts for batch processing (20 available)\nconst WORKER_CONTRACTS: Record<string, string> = {\n    worker1: 'CA46744JXE6PUFP2E4G26QKBG3DTA3RIGGWGTP2QIEKZ6U3CQ3LKM7SH',\n    worker2: 'CAWHF5NQMVED6ANSUMG3OXEMWQHOX2K53VSOK5FO3MMMG7Y5YMFMZABZ',\n    worker3: 'CC6VG5BLTU4SIZQAFOQZOIOEKLQAR2NYTMPOLZVULK7ZHYUTE7YKORPJ',\n    worker4: 'CCOV6M4AEP7TGZ3NIMFGUXMWO3TXSWHSHDGGMIYNN7QM2COM7ITEJBMU',\n    worker5: 'CDWIM6L5FKT3PQ7PCM5UFUIWPS22YVQWUMIMPKLPKBVFUKD5JJUQNH27',\n    worker6: 'CD236CW2YLUXXWK4WT6BRDKMDDCKZKPU5RJRSVL64H6XZLXEU3UZ73GF',\n    worker7: 'CB7O7WGBXMVGES75LSLVC277YIHVHGO75RN7YJELE7IQ2664TMZ4OLG6',\n    worker8: 'CBAUCRBOPXN33TIUIMBCQ2BPWPA446IWMK32KYO43RGOLG3KPBE3L5J2',\n    worker9: 'CCM6WJHG6CDN7YCR4BVSFKJVQEOW5BA6IHH6RSXX5QRPLNS7E4UL4SLN',\n    worker10: 'CBHRLC3IY6OIOGTU4E737IKPWV46N43NLTJX2ZIYGK7ZI6B4TRL7HIIC',\n    worker11: 'CC6N434Q5GH4TIN4NVXK7FWZHLEAAC3MIZATRHT3YK2VEAVK3GKW62CE',\n    worker12: 'CBGMTVKUULAVZ3UJQMJ74SISODP5FV5W2UGSWXHYGXUAYGLMXTM3QKHH',\n    worker13: 'CBCWTKVJEVDNYLMK7PD5VU67IX46BPCSOH75EINCF4MIYJW7HUF2O7P6',\n    worker14: 'CCNZ753NQBP67AZSYCQNLCVW56ZAY36AQMTNOBI2WKLP4GNR5ARBRIES',\n    worker15: 'CAEPOYMB33T6MQXNA2C5HLXNCKHLC5RCMF7EFCMPB3M2764RRUACC2E6',\n    worker16: 'CCJYOSKABCA4XDATIPB4BJI63GQ25AMGXFQSY6KSZ3AMCWAD6OF4L3RW',\n    worker17: 'CBEJCOJBK5QWHSOPLZY6OGY2446JXC5UJG2565NAQNP2BBY3WSRWZD57',\n    worker18: 'CB2TXKCIFCITSG4QICQAWJ4GPVJ6YBVBKBPTEAA5IDHL2QKHZ7FCLGNK',\n    worker19: 'CCTMP2VNVVSABI7J2L442KTBLRHYAMVIB632UTBZYZDMV3RIGU4OUBBY',\n    worker20: 'CBFYQMR7BY7CANCIWJEAL7LYVURWUIKZZZFM3FR2B765HZKTGYLEYLWW',\n};\n\n// ==================== TYPE DEFINITIONS ====================\n\nexport interface PaymentRecipient {\n    address: string;\n    amount: bigint; // In stroops (1 XLM = 10_000_000n)\n}\n\nexport interface BatchConfig {\n    workerContractId: string;\n    recipients: string[];\n    amounts: bigint[];\n}\n\nexport interface AuthTreeBuildResult {\n    authEntry: xdr.SorobanAuthorizationEntry;\n    authPayload: Buffer;           // Hash of preimage (for manual signing)\n    authPreimageXdr: string;       // Base64 XDR of preimage (for Freighter signAuthEntry)\n    expirationLedger: number;\n    nonce: bigint;\n}\n\nexport interface TransactionResult {\n    success: boolean;\n    hash?: string;\n    ledger?: number;\n    error?: string;\n    totalPayments?: number;\n}\n\nexport type NetworkType = 'testnet' | 'mainnet';\n\n// ==================== SAFE LIMITS ====================\n\nexport const SAFE_LIMITS = {\n    MAX_RECIPIENTS_PER_BATCH: 19,  // Don't use 20 (contract limit buffer)\n    MAX_TOTAL_RECIPIENTS: 80,      // Stay under 81 for resource limits\n    MAX_BATCHES: 5,                // 5 batches Ã— 19 = 95, but 80 is safer\n    FEE_BUFFER_MULTIPLIER: 2.0,   // 2x the simulated fee\n    STROOPS_PER_XLM: 10_000_000n,\n};\n\n// ==================== MAIN SERVICE CLASS ====================\n\nexport class BulkPaymentService {\n    private server: rpc.Server;\n    private networkPassphrase: string;\n    private orchestratorContract: string;\n    private xlmSac: string;\n    private workerContracts: string[];\n\n    constructor(network: NetworkType = 'testnet') {\n        const config = network === 'mainnet' ? CONFIG.MAINNET : CONFIG.TESTNET;\n\n        this.server = new rpc.Server(config.RPC_URL, { allowHttp: true });\n        this.networkPassphrase = config.NETWORK_PASSPHRASE;\n        this.orchestratorContract = config.ORCHESTRATOR_CONTRACT;\n        this.xlmSac = config.XLM_SAC;\n        this.workerContracts = Object.values(WORKER_CONTRACTS);\n    }\n\n    // ==================== PUBLIC METHODS ====================\n\n    /**\n     * Validates and creates batches from a list of recipients\n     * Returns error if validation fails\n     */\n    validateAndCreateBatches(recipients: PaymentRecipient[]): {\n        batches?: BatchConfig[];\n        error?: string;\n        stats?: {\n            totalRecipients: number;\n            totalAmount: bigint;\n            batchCount: number;\n            recipientsPerBatch: number[];\n        };\n    } {\n        // Validate recipient count\n        if (recipients.length === 0) {\n            return { error: 'No recipients provided' };\n        }\n\n        if (recipients.length > SAFE_LIMITS.MAX_TOTAL_RECIPIENTS) {\n            return {\n                error: `Maximum ${SAFE_LIMITS.MAX_TOTAL_RECIPIENTS} recipients per transaction. You provided ${recipients.length}.`\n            };\n        }\n\n        // Validate addresses and amounts\n        for (let i = 0; i < recipients.length; i++) {\n            const r = recipients[i];\n\n            // Validate address format (basic check)\n            if (!r.address || r.address.length !== 56 || !r.address.startsWith('G')) {\n                return { error: `Invalid Stellar address at row ${i + 1}: ${r.address}` };\n            }\n\n            // Validate amount\n            if (r.amount <= 0n) {\n                return { error: `Amount must be positive at row ${i + 1}` };\n            }\n        }\n\n        // Create batches\n        const batches: BatchConfig[] = [];\n        const recipientsPerBatch: number[] = [];\n\n        for (let i = 0; i < recipients.length; i += SAFE_LIMITS.MAX_RECIPIENTS_PER_BATCH) {\n            const batchRecipients = recipients.slice(i, i + SAFE_LIMITS.MAX_RECIPIENTS_PER_BATCH);\n            const workerIndex = batches.length % this.workerContracts.length;\n\n            batches.push({\n                workerContractId: this.workerContracts[workerIndex],\n                recipients: batchRecipients.map(r => r.address),\n                amounts: batchRecipients.map(r => r.amount),\n            });\n\n            recipientsPerBatch.push(batchRecipients.length);\n        }\n\n        const totalAmount = recipients.reduce((sum, r) => sum + r.amount, 0n);\n\n        return {\n            batches,\n            stats: {\n                totalRecipients: recipients.length,\n                totalAmount,\n                batchCount: batches.length,\n                recipientsPerBatch,\n            },\n        };\n    }\n\n    /**\n     * Builds the 3-level authorization tree for orchestrated payments\n     * This is the key function that enables SINGLE SIGNATURE for all batches\n     */\n    async buildAuthTree(\n        userPublicKey: string,\n        batches: BatchConfig[]\n    ): Promise<AuthTreeBuildResult> {\n        // Get current ledger for nonce and expiration\n        const ledgerResponse = await this.server.getLatestLedger();\n        const currentLedger = ledgerResponse.sequence;\n        const expirationLedger = currentLedger + 1000; // ~83 minutes validity\n        const nonce = BigInt(currentLedger);\n\n        // Build Level 3: Token transfer sub-invocations for each batch\n        const batchSubInvocations: xdr.SorobanAuthorizedInvocation[] = batches.map(batch => {\n            // Build transfer invocations (Level 3)\n            const transferInvocations = batch.recipients.map((recipient, i) => {\n                return new xdr.SorobanAuthorizedInvocation({\n                    function: xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(\n                        new xdr.InvokeContractArgs({\n                            contractAddress: new Address(this.xlmSac).toScAddress(),\n                            functionName: 'transfer',\n                            args: [\n                                new Address(userPublicKey).toScVal(),\n                                new Address(recipient).toScVal(),\n                                nativeToScVal(batch.amounts[i], { type: 'i128' }),\n                            ],\n                        })\n                    ),\n                    subInvocations: [],\n                });\n            });\n\n            // Build Level 2: Worker batch_pay invocation\n            return new xdr.SorobanAuthorizedInvocation({\n                function: xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(\n                    new xdr.InvokeContractArgs({\n                        contractAddress: new Address(batch.workerContractId).toScAddress(),\n                        functionName: 'batch_pay',\n                        args: [\n                            new Address(userPublicKey).toScVal(),\n                            xdr.ScVal.scvVec(batch.recipients.map(r => new Address(r).toScVal())),\n                            xdr.ScVal.scvVec(batch.amounts.map(a => nativeToScVal(a, { type: 'i128' }))),\n                            new Address(this.xlmSac).toScVal(),\n                        ],\n                    })\n                ),\n                subInvocations: transferInvocations,\n            });\n        });\n\n        // Build Level 1: Orchestrator root invocation\n        // Convert batches to BatchConfig ScVal format\n        // IMPORTANT: Map entries MUST be in alphabetical order for Soroban\n        const batchesScVal = xdr.ScVal.scvVec(\n            batches.map(batch =>\n                xdr.ScVal.scvMap([\n                    new xdr.ScMapEntry({\n                        key: xdr.ScVal.scvSymbol('amounts'),\n                        val: xdr.ScVal.scvVec(batch.amounts.map(a => nativeToScVal(a, { type: 'i128' }))),\n                    }),\n                    new xdr.ScMapEntry({\n                        key: xdr.ScVal.scvSymbol('recipients'),\n                        val: xdr.ScVal.scvVec(batch.recipients.map(r => new Address(r).toScVal())),\n                    }),\n                    new xdr.ScMapEntry({\n                        key: xdr.ScVal.scvSymbol('worker_contract'),\n                        val: new Address(batch.workerContractId).toScVal(),\n                    }),\n                ])\n            )\n        );\n\n        const rootInvocation = new xdr.SorobanAuthorizedInvocation({\n            function: xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(\n                new xdr.InvokeContractArgs({\n                    contractAddress: new Address(this.orchestratorContract).toScAddress(),\n                    functionName: 'orchestrate_payments',\n                    args: [\n                        new Address(userPublicKey).toScVal(),\n                        batchesScVal,\n                        new Address(this.xlmSac).toScVal(),\n                    ],\n                })\n            ),\n            subInvocations: batchSubInvocations,\n        });\n\n        // Build the authorization entry with credentials placeholder\n        const authEntry = new xdr.SorobanAuthorizationEntry({\n            credentials: xdr.SorobanCredentials.sorobanCredentialsAddress(\n                new xdr.SorobanAddressCredentials({\n                    address: new Address(userPublicKey).toScAddress(),\n                    nonce: xdr.Int64.fromString(nonce.toString()),\n                    signatureExpirationLedger: expirationLedger,\n                    signature: xdr.ScVal.scvVoid(), // Placeholder - will be filled after signing\n                })\n            ),\n            rootInvocation: rootInvocation,\n        });\n\n        // Compute the hash payload that needs to be signed\n        const networkId = hash(Buffer.from(this.networkPassphrase));\n        const hashIdPreimage = xdr.HashIdPreimage.envelopeTypeSorobanAuthorization(\n            new xdr.HashIdPreimageSorobanAuthorization({\n                networkId: networkId,\n                nonce: xdr.Int64.fromString(nonce.toString()),\n                signatureExpirationLedger: expirationLedger,\n                invocation: rootInvocation,\n            })\n        );\n\n        // Get the preimage XDR for Freighter (it hashes internally)\n        const preimageXdr = hashIdPreimage.toXDR();\n        const authPreimageXdr = preimageXdr.toString('base64');\n        \n        // Also compute the hash for manual signing scenarios\n        const authPayload = hash(preimageXdr);\n\n        return {\n            authEntry,\n            authPayload,\n            authPreimageXdr,\n            expirationLedger,\n            nonce,\n        };\n    }\n\n    /**\n     * Signs the authorization entry with the wallet's signing function\n     * Returns the signed auth entry ready for transaction submission\n     */\n    async signAuthEntry(\n        authEntry: xdr.SorobanAuthorizationEntry,\n        userPublicKey: string,\n        signFunction: (payload: Buffer) => Promise<Buffer>,\n        authPayload: Buffer\n    ): Promise<xdr.SorobanAuthorizationEntry> {\n        // Get the signature from the wallet\n        const signature = await signFunction(authPayload);\n\n        // Build the signature ScVal - MUST be Vec<Map> format for Stellar/Soroban\n        // The Vec allows for multiple signers, Map contains public_key and signature\n        const signatureScVal = xdr.ScVal.scvVec([\n            xdr.ScVal.scvMap([\n                new xdr.ScMapEntry({\n                    key: xdr.ScVal.scvSymbol('public_key'),\n                    val: xdr.ScVal.scvBytes(Keypair.fromPublicKey(userPublicKey).rawPublicKey()),\n                }),\n                new xdr.ScMapEntry({\n                    key: xdr.ScVal.scvSymbol('signature'),\n                    val: xdr.ScVal.scvBytes(signature),\n                }),\n            ]),\n        ]);\n\n        // Create new credentials with the signature\n        const credentials = authEntry.credentials();\n        const addressCreds = credentials.address();\n\n        const signedCredentials = xdr.SorobanCredentials.sorobanCredentialsAddress(\n            new xdr.SorobanAddressCredentials({\n                address: addressCreds.address(),\n                nonce: addressCreds.nonce(),\n                signatureExpirationLedger: addressCreds.signatureExpirationLedger(),\n                signature: signatureScVal,\n            })\n        );\n\n        return new xdr.SorobanAuthorizationEntry({\n            credentials: signedCredentials,\n            rootInvocation: authEntry.rootInvocation(),\n        });\n    }\n\n    /**\n     * Submits the signed authorization entry as a transaction\n     * Returns the transaction result\n     */\n    async submitTransaction(\n        signedAuthEntry: xdr.SorobanAuthorizationEntry,\n        serviceSecretKey: string\n    ): Promise<TransactionResult> {\n        const serviceKeypair = Keypair.fromSecret(serviceSecretKey);\n        const serviceAddress = serviceKeypair.publicKey();\n\n        console.log('=== Submit Transaction Debug ===');\n        console.log('Service address:', serviceAddress);\n        console.log('Orchestrator contract:', this.orchestratorContract);\n        console.log('XLM SAC:', this.xlmSac);\n\n        // Load service account\n        let serviceAccount: Account;\n        try {\n            serviceAccount = await this.server.getAccount(serviceAddress);\n        } catch (e) {\n            return {\n                success: false,\n                error: `Failed to load service account: ${serviceAddress}. Ensure it is funded.`,\n            };\n        }\n\n        // Extract the invoke contract args from the auth entry\n        const rootInvocation = signedAuthEntry.rootInvocation();\n        const invokeContractArgs = rootInvocation.function().contractFn();\n\n        // Create the host function\n        const hostFunction = xdr.HostFunction.hostFunctionTypeInvokeContract(invokeContractArgs);\n\n        // Create the invoke operation\n        const invokeOp = Operation.invokeHostFunction({\n            func: hostFunction,\n            auth: [signedAuthEntry],\n        });\n\n        // Build transaction for simulation\n        const simTx = new TransactionBuilder(serviceAccount, {\n            fee: '100',\n            networkPassphrase: this.networkPassphrase,\n        })\n            .addOperation(invokeOp)\n            .setTimeout(60)\n            .build();\n\n        // Simulate\n        const simResponse = await this.server.simulateTransaction(simTx);\n\n        if (rpc.Api.isSimulationError(simResponse)) {\n            // Extract more detailed error info\n            console.error('=== Simulation Error ===');\n            console.error('Error:', simResponse.error);\n            console.error('Full response:', JSON.stringify(simResponse, null, 2));\n            \n            // Try to extract more specific error info\n            let errorMessage = simResponse.error || 'Unknown simulation error';\n            \n            return {\n                success: false,\n                error: `Simulation failed: ${errorMessage}`,\n            };\n        }\n\n        // Build final transaction with resource data\n        const sorobanData = simResponse.transactionData?.build();\n        const feeWithBuffer = Math.ceil(\n            parseInt(simResponse.minResourceFee || '0') * SAFE_LIMITS.FEE_BUFFER_MULTIPLIER\n        );\n\n        // Reload account for correct sequence number\n        serviceAccount = await this.server.getAccount(serviceAddress);\n\n        const finalTx = new TransactionBuilder(serviceAccount, {\n            fee: feeWithBuffer.toString(),\n            networkPassphrase: this.networkPassphrase,\n        })\n            .setSorobanData(sorobanData!)\n            .addOperation(invokeOp)\n            .setTimeout(90)\n            .build();\n\n        // Sign with service key (pays fees)\n        finalTx.sign(serviceKeypair);\n\n        // Submit\n        const sendResponse = await this.server.sendTransaction(finalTx);\n\n        if (sendResponse.status !== 'PENDING') {\n            return {\n                success: false,\n                error: `Transaction submission failed. Status: ${sendResponse.status}`,\n            };\n        }\n\n        // Wait for confirmation\n        let txStatus = await this.server.getTransaction(sendResponse.hash);\n        let attempts = 0;\n        const maxAttempts = 30;\n\n        while (txStatus.status === 'NOT_FOUND' && attempts < maxAttempts) {\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            txStatus = await this.server.getTransaction(sendResponse.hash);\n            attempts++;\n        }\n\n        if (txStatus.status === 'SUCCESS') {\n            return {\n                success: true,\n                hash: sendResponse.hash,\n                ledger: txStatus.ledger,\n            };\n        }\n\n        return {\n            success: false,\n            error: `Transaction failed with status: ${txStatus.status}`,\n            hash: sendResponse.hash,\n        };\n    }\n\n\n    /**\n     * Checks if a Stellar account exists on the network.\n     * @param publicKey The public key of the account to check.\n     * @returns An object indicating if the account exists and an error message if not.\n     */\n    async checkAccountExists(publicKey: string): Promise<{ exists: boolean; error?: string }> {\n        try {\n            await this.server.getAccount(publicKey);\n            return { exists: true };\n        } catch (e: any) {\n            if (e.message?.includes('Not Found') || e.code === 404) {\n                return {\n                    exists: false,\n                    error: `Account ${publicKey} does not exist on the network. Please fund it first.`\n                };\n            }\n            // Re-throw or return a generic error if it's not a \"Not Found\" issue\n            return { exists: false, error: e.message || 'An unknown error occurred while checking account existence.' };\n        }\n    }\n\n    // ==================== UTILITY METHODS ====================\n\n    /**\n     * Converts XLM to stroops\n     */\n    static xlmToStroops(xlm: number | string): bigint {\n        const xlmNum = typeof xlm === 'string' ? parseFloat(xlm) : xlm;\n        return BigInt(Math.floor(xlmNum * Number(SAFE_LIMITS.STROOPS_PER_XLM)));\n    }\n\n    /**\n     * Converts stroops to XLM\n     */\n    static stroopsToXlm(stroops: bigint): string {\n        return (Number(stroops) / Number(SAFE_LIMITS.STROOPS_PER_XLM)).toFixed(7);\n    }\n\n    /**\n     * Parses CSV content into payment recipients\n     * Expected format: address,amount (amount in XLM)\n     */\n    static parseCSV(csvContent: string): {\n        recipients?: PaymentRecipient[];\n        error?: string;\n        warnings?: string[];\n    } {\n        const lines = csvContent.trim().split('\\n');\n        const recipients: PaymentRecipient[] = [];\n        const warnings: string[] = [];\n\n        // Skip header if present\n        let startLine = 0;\n        const firstLine = lines[0].toLowerCase();\n        if (firstLine.includes('address') || firstLine.includes('recipient') || firstLine.includes('amount')) {\n            startLine = 1;\n        }\n\n        for (let i = startLine; i < lines.length; i++) {\n            const line = lines[i].trim();\n            if (!line) continue;\n\n            const parts = line.split(',').map(p => p.trim());\n            if (parts.length < 2) {\n                return { error: `Invalid format at line ${i + 1}: expected \"address,amount\"` };\n            }\n\n            const address = parts[0];\n            const amountStr = parts[1];\n\n            // Parse amount (assuming XLM)\n            const amount = parseFloat(amountStr);\n            if (isNaN(amount) || amount <= 0) {\n                return { error: `Invalid amount at line ${i + 1}: ${amountStr}` };\n            }\n\n            // Warn about very small amounts\n            if (amount < 0.0000001) {\n                warnings.push(`Very small amount at line ${i + 1}: ${amountStr} XLM`);\n            }\n\n            recipients.push({\n                address,\n                amount: BulkPaymentService.xlmToStroops(amount),\n            });\n        }\n\n        if (recipients.length === 0) {\n            return { error: 'No valid recipients found in CSV' };\n        }\n\n        return { recipients, warnings };\n    }\n\n    /**\n     * Gets the orchestrator contract address\n     */\n    getOrchestratorContract(): string {\n        return this.orchestratorContract;\n    }\n\n    /**\n     * Gets the XLM SAC address\n     */\n    getXlmSac(): string {\n        return this.xlmSac;\n    }\n\n    /**\n     * Gets the RPC server instance\n     */\n    getServer(): rpc.Server {\n        return this.server;\n    }\n}\n\n// Export singleton for convenience\nexport const bulkPaymentService = new BulkPaymentService('testnet');\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 525, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushalchaudhari/Desktop/Tesseract-Client/tesseract-client/app/batch-payments/components/RecipientsInput.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useCallback } from 'react';\nimport { SAFE_LIMITS } from '@/app/services/bulkPaymentService';\n\nexport interface Recipient {\n  id: string;\n  address: string;\n  amount: string;\n  isValid: boolean;\n  error?: string;\n}\n\ninterface RecipientsInputProps {\n  recipients: Recipient[];\n  onRecipientsChange: (recipients: Recipient[]) => void;\n  disabled?: boolean;\n}\n\nexport default function RecipientsInput({\n  recipients,\n  onRecipientsChange,\n  disabled = false,\n}: RecipientsInputProps) {\n  const [dragActive, setDragActive] = useState(false);\n  const [inputMode, setInputMode] = useState<'manual' | 'csv'>('manual');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Generate unique ID\n  const generateId = () => `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  // Validate a single recipient\n  const validateRecipient = (address: string, amount: string): { isValid: boolean; error?: string } => {\n    if (!address.trim()) {\n      return { isValid: false, error: 'Address required' };\n    }\n\n    if (address.length !== 56 || !address.startsWith('G')) {\n      return { isValid: false, error: 'Invalid Stellar address' };\n    }\n\n    const amountNum = parseFloat(amount);\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return { isValid: false, error: 'Invalid amount' };\n    }\n\n    return { isValid: true };\n  };\n\n  // Add empty recipient row\n  const addRecipient = () => {\n    if (recipients.length >= SAFE_LIMITS.MAX_TOTAL_RECIPIENTS) return;\n\n    const newRecipient: Recipient = {\n      id: generateId(),\n      address: '',\n      amount: '',\n      isValid: false,\n    };\n    onRecipientsChange([...recipients, newRecipient]);\n  };\n\n  // Update recipient\n  const updateRecipient = (id: string, field: 'address' | 'amount', value: string) => {\n    const updated = recipients.map((r) => {\n      if (r.id !== id) return r;\n\n      const newAddress = field === 'address' ? value : r.address;\n      const newAmount = field === 'amount' ? value : r.amount;\n      const validation = validateRecipient(newAddress, newAmount);\n\n      return {\n        ...r,\n        [field]: value,\n        isValid: validation.isValid,\n        error: validation.error,\n      };\n    });\n    onRecipientsChange(updated);\n  };\n\n  // Remove recipient\n  const removeRecipient = (id: string) => {\n    if (recipients.length <= 1) return;\n    onRecipientsChange(recipients.filter((r) => r.id !== id));\n  };\n\n  // Handle CSV file upload\n  const handleFileUpload = useCallback(\n    (file: File) => {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const content = e.target?.result as string;\n        const lines = content.trim().split('\\n');\n\n        // Skip header if present\n        let startLine = 0;\n        const firstLine = lines[0].toLowerCase();\n        if (firstLine.includes('address') || firstLine.includes('recipient')) {\n          startLine = 1;\n        }\n\n        const newRecipients: Recipient[] = [];\n\n        for (let i = startLine; i < lines.length && newRecipients.length < SAFE_LIMITS.MAX_TOTAL_RECIPIENTS; i++) {\n          const line = lines[i].trim();\n          if (!line) continue;\n\n          const parts = line.split(',').map((p) => p.trim());\n          if (parts.length >= 2) {\n            const address = parts[0];\n            const amount = parts[1];\n            const validation = validateRecipient(address, amount);\n\n            newRecipients.push({\n              id: generateId(),\n              address,\n              amount,\n              isValid: validation.isValid,\n              error: validation.error,\n            });\n          }\n        }\n\n        if (newRecipients.length > 0) {\n          onRecipientsChange(newRecipients);\n          setInputMode('csv');\n        }\n      };\n      reader.readAsText(file);\n    },\n    [onRecipientsChange]\n  );\n\n  // Handle drag events\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(true);\n    } else if (e.type === 'dragleave') {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      handleFileUpload(e.dataTransfer.files[0]);\n    }\n  };\n\n  // Clear all and reset\n  const clearAll = () => {\n    onRecipientsChange([\n      {\n        id: generateId(),\n        address: '',\n        amount: '',\n        isValid: false,\n      },\n    ]);\n    setInputMode('manual');\n  };\n\n  const validCount = recipients.filter((r) => r.isValid).length;\n  const totalAmount = recipients\n    .filter((r) => r.isValid)\n    .reduce((sum, r) => sum + parseFloat(r.amount), 0);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Mode Toggle and Info */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex bg-white/5 rounded-lg p-1\">\n            <button\n              onClick={() => setInputMode('manual')}\n              className={`px-3 py-1.5 text-sm rounded-md transition-all ${\n                inputMode === 'manual'\n                  ? 'bg-white/10 text-white'\n                  : 'text-white/50 hover:text-white'\n              }`}\n              disabled={disabled}\n            >\n              Manual Entry\n            </button>\n            <button\n              onClick={() => fileInputRef.current?.click()}\n              className={`px-3 py-1.5 text-sm rounded-md transition-all ${\n                inputMode === 'csv'\n                  ? 'bg-white/10 text-white'\n                  : 'text-white/50 hover:text-white'\n              }`}\n              disabled={disabled}\n            >\n              Upload CSV\n            </button>\n          </div>\n        </div>\n\n        <div className=\"text-sm text-white/50\">\n          {validCount}/{SAFE_LIMITS.MAX_TOTAL_RECIPIENTS} recipients\n        </div>\n      </div>\n\n      {/* CSV Drop Zone */}\n      <div\n        className={`relative border-2 border-dashed rounded-xl p-6 text-center transition-all ${\n          dragActive\n            ? 'border-blue-500 bg-blue-500/10'\n            : 'border-white/20 hover:border-white/30'\n        } ${disabled ? 'opacity-50 pointer-events-none' : ''}`}\n        onDragEnter={handleDrag}\n        onDragLeave={handleDrag}\n        onDragOver={handleDrag}\n        onDrop={handleDrop}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\".csv,.txt\"\n          onChange={(e) => e.target.files?.[0] && handleFileUpload(e.target.files[0])}\n          className=\"hidden\"\n          disabled={disabled}\n        />\n\n        <svg className=\"w-10 h-10 mx-auto mb-3 text-white/30\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\n        </svg>\n        <p className=\"text-sm text-white/60 mb-1\">\n          Drag and drop CSV file here, or{' '}\n          <button\n            onClick={() => fileInputRef.current?.click()}\n            className=\"text-blue-400 hover:text-blue-300\"\n            disabled={disabled}\n          >\n            browse\n          </button>\n        </p>\n        <p className=\"text-xs text-white/40\">Format: address,amount (amount in XLM)</p>\n      </div>\n\n      {/* Recipients Table */}\n      <div className=\"bg-black/20 rounded-xl border border-white/10 overflow-hidden\">\n        {/* Table Header */}\n        <div className=\"grid grid-cols-[1fr_120px_40px] gap-2 px-4 py-3 bg-white/5 border-b border-white/10\">\n          <div className=\"text-xs font-medium text-white/60 uppercase tracking-wider\">\n            Recipient Address\n          </div>\n          <div className=\"text-xs font-medium text-white/60 uppercase tracking-wider\">\n            Amount (XLM)\n          </div>\n          <div></div>\n        </div>\n\n        {/* Table Body */}\n        <div className=\"max-h-[320px] overflow-y-auto\">\n          {recipients.map((recipient, index) => (\n            <div\n              key={recipient.id}\n              className={`grid grid-cols-[1fr_120px_40px] gap-2 px-4 py-2 border-b border-white/5 ${\n                !recipient.isValid && (recipient.address || recipient.amount)\n                  ? 'bg-red-500/5'\n                  : ''\n              }`}\n            >\n              {/* Address Input */}\n              <div className=\"relative\">\n                <input\n                  type=\"text\"\n                  value={recipient.address}\n                  onChange={(e) => updateRecipient(recipient.id, 'address', e.target.value)}\n                  placeholder=\"G...\"\n                  className={`w-full bg-transparent border-0 text-sm font-mono text-white placeholder-white/30 focus:outline-none focus:ring-0 ${\n                    !recipient.isValid && recipient.address ? 'text-red-400' : ''\n                  }`}\n                  disabled={disabled}\n                />\n                {recipient.error && recipient.address && (\n                  <div className=\"absolute -bottom-4 left-0 text-xs text-red-400\">\n                    {recipient.error}\n                  </div>\n                )}\n              </div>\n\n              {/* Amount Input */}\n              <input\n                type=\"number\"\n                step=\"0.0000001\"\n                min=\"0\"\n                value={recipient.amount}\n                onChange={(e) => updateRecipient(recipient.id, 'amount', e.target.value)}\n                placeholder=\"0.00\"\n                className=\"w-full bg-transparent border-0 text-sm text-white placeholder-white/30 focus:outline-none focus:ring-0\"\n                disabled={disabled}\n              />\n\n              {/* Remove Button */}\n              <button\n                onClick={() => removeRecipient(recipient.id)}\n                className=\"flex items-center justify-center text-white/30 hover:text-red-400 transition-colors\"\n                disabled={disabled || recipients.length <= 1}\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n          ))}\n        </div>\n\n        {/* Add Row Button */}\n        <div className=\"px-4 py-3 border-t border-white/10\">\n          <button\n            onClick={addRecipient}\n            disabled={disabled || recipients.length >= SAFE_LIMITS.MAX_TOTAL_RECIPIENTS}\n            className=\"flex items-center gap-2 text-sm text-white/50 hover:text-white transition-colors disabled:opacity-30\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n            </svg>\n            Add Recipient\n          </button>\n        </div>\n      </div>\n\n      {/* Summary Stats */}\n      <div className=\"grid grid-cols-3 gap-4 p-4 bg-white/5 rounded-xl\">\n        <div>\n          <div className=\"text-xs text-white/40 mb-1\">Valid Recipients</div>\n          <div className=\"text-lg font-semibold text-white\">\n            {validCount}\n            <span className=\"text-sm text-white/40\">/{recipients.length}</span>\n          </div>\n        </div>\n        <div>\n          <div className=\"text-xs text-white/40 mb-1\">Total Amount</div>\n          <div className=\"text-lg font-semibold text-white\">\n            {totalAmount.toFixed(2)}\n            <span className=\"text-sm text-white/40\"> XLM</span>\n          </div>\n        </div>\n        <div>\n          <div className=\"text-xs text-white/40 mb-1\">Batches</div>\n          <div className=\"text-lg font-semibold text-white\">\n            {Math.ceil(validCount / SAFE_LIMITS.MAX_RECIPIENTS_PER_BATCH) || 0}\n          </div>\n        </div>\n      </div>\n\n      {/* Limit Warning */}\n      {recipients.length >= SAFE_LIMITS.MAX_TOTAL_RECIPIENTS  && (\n        <div className=\"flex items-center gap-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg\">\n          <svg className=\"w-4 h-4 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n          </svg>\n          <span className=\"text-sm text-yellow-200\">\n            Approaching limit: Maximum {SAFE_LIMITS.MAX_TOTAL_RECIPIENTS} recipients per transaction\n          </span>\n        </div>\n      )}\n\n      {/* Clear Button */}\n      {recipients.length > 1 && (\n        <button\n          onClick={clearAll}\n          disabled={disabled}\n          className=\"text-sm text-white/40 hover:text-white transition-colors\"\n        >\n          Clear all recipients\n        </button>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1153, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushalchaudhari/Desktop/Tesseract-Client/tesseract-client/app/batch-payments/components/AuthTreeVisualization.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useRef, useCallback } from 'react';\n\ninterface AuthTreeNode {\n  id: string;\n  label: string;\n  type: 'orchestrator' | 'worker' | 'transfer';\n  children?: AuthTreeNode[];\n  status: 'pending' | 'active' | 'complete';\n}\n\n// Transaction state type matching the parent component\ntype TransactionState = 'idle' | 'preparing' | 'signing' | 'submitting' | 'success' | 'error';\n\ninterface AuthTreeVisualizationProps {\n  batches: {\n    workerIndex: number;\n    recipientCount: number;\n  }[];\n  isProcessing: boolean;\n  isComplete: boolean;\n  transactionHash?: string;\n  // NEW: Actual transaction state for proper synchronization\n  transactionState?: TransactionState;\n  // NEW: Callback when visualization completes its animation\n  onVisualizationComplete?: () => void;\n}\n\n// Completion animation duration (when transaction finishes, how long to animate to 100%)\nconst COMPLETION_ANIMATION_MS = 2000;\n// Minimum progress per phase to show meaningful animation\nconst MIN_PHASE_DURATION_MS = 800;\n\n// Easing function for smooth animations\nfunction easeOutCubic(t: number): number {\n  return 1 - Math.pow(1 - t, 3);\n}\n\nexport default function AuthTreeVisualization({\n  batches,\n  isProcessing,\n  isComplete,\n  transactionHash,\n  transactionState = 'idle',\n  onVisualizationComplete,\n}: AuthTreeVisualizationProps) {\n  const [animationProgress, setAnimationProgress] = useState(0);\n  const [currentPhase, setCurrentPhase] = useState<'idle' | 'building' | 'signing' | 'submitting' | 'complete'>('idle');\n  const [isVisualizationComplete, setIsVisualizationComplete] = useState(false);\n\n  const animationRef = useRef<number | null>(null);\n  const phaseStartTimeRef = useRef<number | null>(null);\n  const completionStartTimeRef = useRef<number | null>(null);\n  const progressAtCompletionRef = useRef<number>(0);\n  const lastPhaseRef = useRef<TransactionState>('idle');\n\n  // Build the tree structure\n  const buildTree = (): AuthTreeNode => {\n    const workers = batches.map((batch, index) => {\n      const transfers = Array.from({ length: batch.recipientCount }, (_, i) => ({\n        id: `transfer-${index}-${i}`,\n        label: `Transfer ${i + 1}`,\n        type: 'transfer' as const,\n        status: 'pending' as const,\n      }));\n\n      return {\n        id: `worker-${index}`,\n        label: `Worker ${index + 1}`,\n        type: 'worker' as const,\n        children: transfers,\n        status: 'pending' as const,\n      };\n    });\n\n    return {\n      id: 'orchestrator',\n      label: 'Orchestrator',\n      type: 'orchestrator' as const,\n      children: workers,\n      status: 'pending' as const,\n    };\n  };\n\n  const tree = buildTree();\n  const totalNodes = 1 + batches.length + batches.reduce((sum, b) => sum + b.recipientCount, 0);\n\n  // Map transaction state to target progress ranges\n  const getTargetProgressForState = useCallback((state: TransactionState): { min: number; max: number } => {\n    switch (state) {\n      case 'preparing':\n        return { min: 0, max: 0.30 }; // 0-30%\n      case 'signing':\n        return { min: 0.30, max: 0.50 }; // 30-50%\n      case 'submitting':\n        return { min: 0.50, max: 0.85 }; // 50-85%\n      case 'success':\n        return { min: 0.85, max: 1.0 }; // 85-100%\n      default:\n        return { min: 0, max: 0 };\n    }\n  }, []);\n\n  // Animate within a phase - smoothly animate toward the phase's max progress\n  const animateWithinPhase = useCallback(() => {\n    if (!phaseStartTimeRef.current) return;\n\n    const elapsed = Date.now() - phaseStartTimeRef.current;\n    const target = getTargetProgressForState(transactionState);\n\n    // Animate toward the max of current phase over MIN_PHASE_DURATION_MS\n    // But cap at 90% of the phase max to leave room for next phase transition\n    const phaseProgress = Math.min(elapsed / MIN_PHASE_DURATION_MS, 1);\n    const cappedMax = target.min + (target.max - target.min) * 0.9;\n    const newProgress = target.min + (cappedMax - target.min) * easeOutCubic(phaseProgress);\n\n    setAnimationProgress(prev => Math.max(prev, newProgress));\n\n    // Update visual phase\n    if (newProgress < 0.30) {\n      setCurrentPhase('building');\n    } else if (newProgress < 0.50) {\n      setCurrentPhase('signing');\n    } else if (newProgress < 0.85) {\n      setCurrentPhase('submitting');\n    }\n\n    // Keep animating if we haven't reached the cap and transaction is still in this phase\n    if (phaseProgress < 1 && !isComplete) {\n      animationRef.current = requestAnimationFrame(animateWithinPhase);\n    }\n  }, [transactionState, isComplete, getTargetProgressForState]);\n\n  // Completion animation - smoothly animate from current progress to 100%\n  const animateToCompletion = useCallback(() => {\n    if (!completionStartTimeRef.current) return;\n\n    const elapsed = Date.now() - completionStartTimeRef.current;\n    const progress = Math.min(elapsed / COMPLETION_ANIMATION_MS, 1);\n\n    // Ease out from current progress to 100%\n    const startProgress = progressAtCompletionRef.current;\n    const newProgress = startProgress + (1 - startProgress) * easeOutCubic(progress);\n\n    setAnimationProgress(newProgress);\n\n    // Update visual phase based on progress\n    if (newProgress < 0.95) {\n      setCurrentPhase('submitting');\n    } else {\n      setCurrentPhase('complete');\n    }\n\n    if (progress < 1) {\n      animationRef.current = requestAnimationFrame(animateToCompletion);\n    } else {\n      // Animation fully complete\n      setIsVisualizationComplete(true);\n      onVisualizationComplete?.();\n    }\n  }, [onVisualizationComplete]);\n\n  // Handle transaction state changes\n  useEffect(() => {\n    // Cancel any existing animation\n    if (animationRef.current) {\n      cancelAnimationFrame(animationRef.current);\n      animationRef.current = null;\n    }\n\n    // Handle state transitions\n    if (transactionState !== lastPhaseRef.current) {\n      lastPhaseRef.current = transactionState;\n\n      if (transactionState === 'preparing') {\n        // Start fresh\n        phaseStartTimeRef.current = Date.now();\n        setCurrentPhase('building');\n        animationRef.current = requestAnimationFrame(animateWithinPhase);\n      } else if (transactionState === 'signing') {\n        phaseStartTimeRef.current = Date.now();\n        setCurrentPhase('signing');\n        // Jump to signing min if we're behind\n        setAnimationProgress(prev => Math.max(prev, 0.30));\n        animationRef.current = requestAnimationFrame(animateWithinPhase);\n      } else if (transactionState === 'submitting') {\n        phaseStartTimeRef.current = Date.now();\n        setCurrentPhase('submitting');\n        // Jump to submitting min if we're behind\n        setAnimationProgress(prev => Math.max(prev, 0.50));\n        animationRef.current = requestAnimationFrame(animateWithinPhase);\n      } else if (transactionState === 'success') {\n        // Transaction complete! Start completion animation\n        progressAtCompletionRef.current = animationProgress;\n        completionStartTimeRef.current = Date.now();\n        animationRef.current = requestAnimationFrame(animateToCompletion);\n      } else if (transactionState === 'error') {\n        // Stop animation on error\n        setCurrentPhase('idle');\n      } else if (transactionState === 'idle') {\n        // Reset everything\n        phaseStartTimeRef.current = null;\n        completionStartTimeRef.current = null;\n        progressAtCompletionRef.current = 0;\n        setAnimationProgress(0);\n        setCurrentPhase('idle');\n        setIsVisualizationComplete(false);\n      }\n    }\n\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n    };\n  }, [transactionState, animateWithinPhase, animateToCompletion, animationProgress]);\n\n  // Fallback: Handle isComplete prop if transactionState isn't being passed\n  useEffect(() => {\n    if (isComplete && transactionState !== 'success' && !completionStartTimeRef.current) {\n      // Fallback for legacy usage without transactionState\n      progressAtCompletionRef.current = animationProgress;\n      completionStartTimeRef.current = Date.now();\n      animationRef.current = requestAnimationFrame(animateToCompletion);\n    }\n  }, [isComplete, transactionState, animationProgress, animateToCompletion]);\n\n  // Reset on new processing (when idle and not complete)\n  useEffect(() => {\n    if (!isProcessing && !isComplete && transactionState === 'idle') {\n      phaseStartTimeRef.current = null;\n      completionStartTimeRef.current = null;\n      progressAtCompletionRef.current = 0;\n      setAnimationProgress(0);\n      setCurrentPhase('idle');\n      setIsVisualizationComplete(false);\n    }\n  }, [isProcessing, isComplete, transactionState]);\n\n  // Calculate node status based on progress\n  const getNodeStatus = (_nodeIndex: number, totalBeforeNode: number): 'pending' | 'active' | 'complete' => {\n    // If visualization is complete, all nodes are complete\n    if (isVisualizationComplete || animationProgress >= 0.99) {\n      return 'complete';\n    }\n\n    const nodeProgress = totalBeforeNode / totalNodes;\n    if (animationProgress >= nodeProgress + (1 / totalNodes)) {\n      return 'complete';\n    } else if (animationProgress >= nodeProgress) {\n      return 'active';\n    }\n    return 'pending';\n  };\n\n  const phaseLabels = {\n    idle: 'Ready to process',\n    building: 'Building Authorization Tree...',\n    signing: 'Awaiting Signature...',\n    submitting: 'Submitting Transaction...',\n    complete: 'Transaction Complete',\n  };\n\n  return (\n    <div className=\"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-semibold text-white\">Authorization Tree</h3>\n        <div className=\"flex items-center gap-2\">\n          {currentPhase !== 'idle' && currentPhase !== 'complete' && (\n            <div className=\"w-2 h-2 rounded-full bg-blue-500 animate-pulse\" />\n          )}\n          {currentPhase === 'complete' && (\n            <div className=\"w-2 h-2 rounded-full bg-green-500\" />\n          )}\n          <span className=\"text-sm text-white/60\">{phaseLabels[currentPhase]}</span>\n        </div>\n      </div>\n\n      {/* Progress Bar */}\n      {currentPhase !== 'idle' && (\n        <div className=\"mb-6\">\n          <div className=\"h-1 bg-white/10 rounded-full overflow-hidden\">\n            <div\n              className=\"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 ease-out\"\n              style={{ width: `${animationProgress * 100}%` }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Tree Visualization */}\n      <div className=\"relative\">\n        {/* Orchestrator Level */}\n        <div className=\"flex flex-col items-center\">\n          <TreeNode\n            label=\"Orchestrator\"\n            sublabel=\"orchestrate_payments()\"\n            status={getNodeStatus(0, 1)}\n            isRoot\n          />\n\n          {/* Connection Lines */}\n          {batches.length > 0 && (\n            <div className=\"relative w-full mt-4 mb-4\">\n              <div className=\"absolute left-1/2 transform -translate-x-1/2 w-px h-6 bg-white/20\" />\n              <div className=\"absolute top-6 left-1/2 transform -translate-x-1/2 w-[80%] h-px bg-white/20\" />\n            </div>\n          )}\n\n          {/* Worker Level */}\n          <div className=\"flex flex-wrap justify-center gap-4 w-full\">\n            {batches.map((batch, workerIndex) => {\n              const nodesBeforeWorker = 1 + workerIndex * (1 + Math.max(...batches.map(b => b.recipientCount)));\n              const workerStatus = getNodeStatus(workerIndex + 1, nodesBeforeWorker / totalNodes);\n\n              return (\n                <div key={workerIndex} className=\"flex flex-col items-center\">\n                  {/* Vertical line from horizontal connector */}\n                  <div className=\"w-px h-4 bg-white/20\" />\n\n                  <TreeNode\n                    label={`Worker ${workerIndex + 1}`}\n                    sublabel={`batch_pay() - ${batch.recipientCount} transfers`}\n                    status={workerStatus}\n                  />\n\n                  {/* Transfer indicators */}\n                  <div className=\"mt-3 flex flex-wrap justify-center gap-1 max-w-[120px]\">\n                    {Array.from({ length: batch.recipientCount }, (_, i) => {\n                      const transferNodeIndex = nodesBeforeWorker + 1 + i;\n                      const transferStatus = getNodeStatus(transferNodeIndex, transferNodeIndex / totalNodes);\n                      return (\n                        <div\n                          key={i}\n                          className={`w-2 h-2 rounded-full transition-all duration-300 ${\n                            transferStatus === 'complete'\n                              ? 'bg-green-500'\n                              : transferStatus === 'active'\n                              ? 'bg-blue-500 animate-pulse'\n                              : 'bg-white/20'\n                          }`}\n                          title={`Transfer ${i + 1}`}\n                        />\n                      );\n                    })}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Stats */}\n      <div className=\"mt-6 pt-6 border-t border-white/10 grid grid-cols-3 gap-4 text-center\">\n        <div>\n          <div className=\"text-2xl font-semibold text-white\">{batches.length}</div>\n          <div className=\"text-xs text-white/40\">Batches</div>\n        </div>\n        <div>\n          <div className=\"text-2xl font-semibold text-white\">\n            {batches.reduce((sum, b) => sum + b.recipientCount, 0)}\n          </div>\n          <div className=\"text-xs text-white/40\">Recipients</div>\n        </div>\n        <div>\n          <div className=\"text-2xl font-semibold text-white\">1</div>\n          <div className=\"text-xs text-white/40\">Signature</div>\n        </div>\n      </div>\n\n      {/* Transaction Hash */}\n      {transactionHash && currentPhase === 'complete' && (\n        <div className=\"mt-4 p-3 bg-green-500/10 border border-green-500/20 rounded-lg\">\n          <div className=\"text-xs text-green-400 mb-1\">Transaction Hash</div>\n          <div className=\"text-sm text-white font-mono truncate\">\n            <a\n              href={`https://stellar.expert/explorer/testnet/tx/${transactionHash}`}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"hover:text-blue-400 transition-colors\"\n            >\n              {transactionHash}\n            </a>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface TreeNodeProps {\n  label: string;\n  sublabel?: string;\n  status: 'pending' | 'active' | 'complete';\n  isRoot?: boolean;\n}\n\nfunction TreeNode({ label, sublabel, status, isRoot }: TreeNodeProps) {\n  const statusStyles = {\n    pending: 'border-white/20 bg-black/40',\n    active: 'border-blue-500 bg-blue-500/10 shadow-lg shadow-blue-500/20',\n    complete: 'border-green-500 bg-green-500/10',\n  };\n\n  const iconStyles = {\n    pending: 'text-white/40',\n    active: 'text-blue-400',\n    complete: 'text-green-400',\n  };\n\n  return (\n    <div\n      className={`relative px-4 py-3 rounded-xl border transition-all duration-300 ${statusStyles[status]} ${\n        isRoot ? 'min-w-[200px]' : 'min-w-[140px]'\n      }`}\n    >\n      <div className=\"flex items-center gap-2\">\n        {/* Status Icon */}\n        <div className={`transition-colors duration-300 ${iconStyles[status]}`}>\n          {status === 'complete' ? (\n            <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n            </svg>\n          ) : status === 'active' ? (\n            <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n            </svg>\n          ) : (\n            <div className=\"w-4 h-4 rounded-full border border-current\" />\n          )}\n        </div>\n\n        <div>\n          <div className=\"text-sm font-medium text-white\">{label}</div>\n          {sublabel && (\n            <div className=\"text-xs text-white/40 font-mono\">{sublabel}</div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1850, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushalchaudhari/Desktop/Tesseract-Client/tesseract-client/app/services/walletService.ts"],"sourcesContent":["/**\n * Wallet Service for Stellar/Soroban integration\n *\n * This service provides a unified interface for wallet operations using the Freighter wallet.\n *\n * References:\n * - Freighter API: https://docs.freighter.app/docs/guide/usingfreighterwebapp/\n * - Sign Auth Entries: https://developers.stellar.org/docs/build/guides/freighter/sign-auth-entries\n */\n\nimport {\n    isConnected,\n    isAllowed,\n    setAllowed,\n    requestAccess,\n    getAddress,\n    getNetworkDetails,\n    signAuthEntry,\n    signTransaction,\n} from '@stellar/freighter-api';\n\n// ==================== TYPE DEFINITIONS ====================\n\nexport interface WalletState {\n    isInstalled: boolean;\n    isConnected: boolean;\n    isAllowed: boolean;\n    address: string | null;\n    network: NetworkInfo | null;\n}\n\nexport interface NetworkInfo {\n    network: string;\n    networkPassphrase: string;\n    networkUrl?: string;\n}\n\nexport interface SignAuthEntryResult {\n    signedAuthEntry: string;\n    signerAddress: string;\n}\n\nexport interface WalletError {\n    code: WalletErrorCode;\n    message: string;\n}\n\nexport enum WalletErrorCode {\n    NOT_INSTALLED = 'NOT_INSTALLED',\n    NOT_ALLOWED = 'NOT_ALLOWED',\n    USER_REJECTED = 'USER_REJECTED',\n    NETWORK_MISMATCH = 'NETWORK_MISMATCH',\n    SIGNING_FAILED = 'SIGNING_FAILED',\n    UNKNOWN = 'UNKNOWN',\n}\n\n// ==================== WALLET SERVICE CLASS ====================\n\nexport class WalletService {\n    private static instance: WalletService;\n\n    private constructor() {}\n\n    /**\n     * Get singleton instance of WalletService\n     */\n    static getInstance(): WalletService {\n        if (!WalletService.instance) {\n            WalletService.instance = new WalletService();\n        }\n        return WalletService.instance;\n    }\n\n    /**\n     * Check if Freighter extension is installed in the browser\n     */\n    async isFreighterInstalled(): Promise<boolean> {\n        try {\n            const result = await isConnected();\n            return result.isConnected;\n        } catch (error) {\n            console.error('Error checking Freighter installation:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Check if the app has been previously allowed by the user\n     */\n    async isAppAllowed(): Promise<boolean> {\n        try {\n            const result = await isAllowed();\n            return result.isAllowed;\n        } catch (error) {\n            console.error('Error checking app permission:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Request app permission from the user\n     * This adds the app to Freighter's allow list\n     */\n    async requestPermission(): Promise<boolean> {\n        try {\n            const result = await setAllowed();\n            return result.isAllowed;\n        } catch (error) {\n            console.error('Error requesting permission:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Connect to the wallet and get the user's public key\n     * This will prompt the user to authorize the app if not already allowed\n     */\n    async connect(): Promise<{ address: string } | WalletError> {\n        try {\n            // First check if Freighter is installed\n            const installed = await this.isFreighterInstalled();\n            if (!installed) {\n                return {\n                    code: WalletErrorCode.NOT_INSTALLED,\n                    message: 'Freighter wallet is not installed. Please install it from https://freighter.app',\n                };\n            }\n\n            // Request access (this prompts the user if not already allowed)\n            const accessResult = await requestAccess();\n\n            if (accessResult.error) {\n                // User rejected or other error\n                return {\n                    code: WalletErrorCode.USER_REJECTED,\n                    message: accessResult.error.message || 'User rejected the connection request',\n                };\n            }\n\n            return { address: accessResult.address };\n        } catch (error: any) {\n            console.error('Error connecting to wallet:', error);\n            return {\n                code: WalletErrorCode.UNKNOWN,\n                message: error.message || 'Failed to connect to wallet',\n            };\n        }\n    }\n\n    /**\n     * Get the currently connected address (without prompting)\n     * Returns null if not connected\n     */\n    async getConnectedAddress(): Promise<string | null> {\n        try {\n            const allowed = await this.isAppAllowed();\n            if (!allowed) {\n                return null;\n            }\n\n            const result = await getAddress();\n            if (result.error) {\n                return null;\n            }\n\n            return result.address;\n        } catch (error) {\n            console.error('Error getting address:', error);\n            return null;\n        }\n    }\n\n    /**\n     * Get the current network information from Freighter\n     */\n    async getNetworkInfo(): Promise<NetworkInfo | null> {\n        try {\n            const result = await getNetworkDetails();\n            if (result.error) {\n                return null;\n            }\n\n            return {\n                network: result.network,\n                networkPassphrase: result.networkPassphrase,\n                networkUrl: result.networkUrl,\n            };\n        } catch (error) {\n            console.error('Error getting network info:', error);\n            return null;\n        }\n    }\n\n    /**\n     * Sign an authorization entry for Soroban contract calls\n     * This is used for the batch payment authorization tree\n     *\n     * @param authEntryPreimageXdr - The XDR string of the HashIdPreimageSorobanAuthorization\n     * @param address - Optional: specific address to sign with\n     * @returns The signed authorization entry as base64 string\n     */\n    async signAuthEntry(\n        authEntryPreimageXdr: string,\n        address?: string\n    ): Promise<SignAuthEntryResult | WalletError> {\n        try {\n            const options: { address?: string } = {};\n            if (address) {\n                options.address = address;\n            }\n\n            const result = await signAuthEntry(authEntryPreimageXdr, options);\n\n            if (result.error) {\n                return {\n                    code: WalletErrorCode.SIGNING_FAILED,\n                    message: result.error.message || 'Failed to sign authorization entry',\n                };\n            }\n\n            return {\n                signedAuthEntry: result.signedAuthEntry || '',\n                signerAddress: result.signerAddress || address || '',\n            };\n        } catch (error: any) {\n            console.error('Error signing auth entry:', error);\n\n            // Check for user rejection\n            if (error.message?.includes('User declined')) {\n                return {\n                    code: WalletErrorCode.USER_REJECTED,\n                    message: 'User declined to sign the authorization entry',\n                };\n            }\n\n            return {\n                code: WalletErrorCode.SIGNING_FAILED,\n                message: error.message || 'Failed to sign authorization entry',\n            };\n        }\n    }\n\n    /**\n     * Sign a transaction XDR\n     *\n     * @param transactionXdr - The XDR string of the transaction\n     * @param network - Network name (TESTNET, PUBLIC, etc.)\n     * @param address - Optional: specific address to sign with\n     * @returns The signed transaction XDR\n     */\n    async signTransaction(\n        transactionXdr: string,\n        network: string = 'TESTNET',\n        address?: string\n    ): Promise<string | WalletError> {\n        try {\n            const options: { network?: string; address?: string; networkPassphrase?: string } = {\n                network,\n            };\n\n            if (address) {\n                options.address = address;\n            }\n\n            const result = await signTransaction(transactionXdr, options);\n\n            if (result.error) {\n                return {\n                    code: WalletErrorCode.SIGNING_FAILED,\n                    message: result.error.message || 'Failed to sign transaction',\n                };\n            }\n\n            return result.signedTxXdr;\n        } catch (error: any) {\n            console.error('Error signing transaction:', error);\n\n            if (error.message?.includes('User declined')) {\n                return {\n                    code: WalletErrorCode.USER_REJECTED,\n                    message: 'User declined to sign the transaction',\n                };\n            }\n\n            return {\n                code: WalletErrorCode.SIGNING_FAILED,\n                message: error.message || 'Failed to sign transaction',\n            };\n        }\n    }\n\n    /**\n     * Get the full wallet state\n     */\n    async getWalletState(): Promise<WalletState> {\n        const isInstalled = await this.isFreighterInstalled();\n\n        if (!isInstalled) {\n            return {\n                isInstalled: false,\n                isConnected: false,\n                isAllowed: false,\n                address: null,\n                network: null,\n            };\n        }\n\n        const allowed = await this.isAppAllowed();\n\n        if (!allowed) {\n            return {\n                isInstalled: true,\n                isConnected: false,\n                isAllowed: false,\n                address: null,\n                network: null,\n            };\n        }\n\n        const address = await this.getConnectedAddress();\n        const network = await this.getNetworkInfo();\n\n        return {\n            isInstalled: true,\n            isConnected: !!address,\n            isAllowed: true,\n            address,\n            network,\n        };\n    }\n\n    /**\n     * Verify the user is on the expected network\n     */\n    async verifyNetwork(expectedPassphrase: string): Promise<boolean> {\n        const networkInfo = await this.getNetworkInfo();\n        if (!networkInfo) {\n            return false;\n        }\n        return networkInfo.networkPassphrase === expectedPassphrase;\n    }\n}\n\n// Export singleton instance\nexport const walletService = WalletService.getInstance();\n\n// Helper function to check if a result is an error\nexport function isWalletError(result: any): result is WalletError {\n    return result && typeof result === 'object' && 'code' in result && 'message' in result;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2124, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushalchaudhari/Desktop/Tesseract-Client/tesseract-client/app/contexts/WalletContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react';\nimport {\n    walletService,\n    WalletState,\n    WalletError,\n    WalletErrorCode,\n    isWalletError,\n    NetworkInfo,\n    SignAuthEntryResult,\n} from '../services/walletService';\n\n// ==================== CONTEXT TYPES ====================\n\ninterface WalletContextType {\n    // State\n    walletState: WalletState;\n    isLoading: boolean;\n    error: WalletError | null;\n\n    // Actions\n    connect: () => Promise<boolean>;\n    disconnect: () => void;\n    refreshState: () => Promise<void>;\n\n    // Signing\n    signAuthEntry: (authEntryPreimageXdr: string) => Promise<SignAuthEntryResult | WalletError>;\n\n    // Utilities\n    formatAddress: (address: string) => string;\n    isTestnet: () => boolean;\n}\n\nconst defaultWalletState: WalletState = {\n    isInstalled: false,\n    isConnected: false,\n    isAllowed: false,\n    address: null,\n    network: null,\n};\n\n// ==================== CONTEXT ====================\n\nconst WalletContext = createContext<WalletContextType | undefined>(undefined);\n\n// ==================== PROVIDER ====================\n\ninterface WalletProviderProps {\n    children: ReactNode;\n}\n\nexport function WalletProvider({ children }: WalletProviderProps) {\n    const [walletState, setWalletState] = useState<WalletState>(defaultWalletState);\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState<WalletError | null>(null);\n\n    /**\n     * Refresh the wallet state from Freighter\n     */\n    const refreshState = useCallback(async () => {\n        try {\n            const state = await walletService.getWalletState();\n            setWalletState(state);\n            setError(null);\n        } catch (err: any) {\n            console.error('Error refreshing wallet state:', err);\n            setError({\n                code: WalletErrorCode.UNKNOWN,\n                message: err.message || 'Failed to refresh wallet state',\n            });\n        }\n    }, []);\n\n    /**\n     * Initial load of wallet state\n     */\n    useEffect(() => {\n        const initialize = async () => {\n            setIsLoading(true);\n            await refreshState();\n            setIsLoading(false);\n        };\n\n        // Only run in browser\n        if (typeof window !== 'undefined') {\n            initialize();\n        } else {\n            setIsLoading(false);\n        }\n    }, [refreshState]);\n\n    /**\n     * Listen for account changes in Freighter\n     * Note: This requires Freighter to emit events, which may not be available in all versions\n     */\n    useEffect(() => {\n        if (typeof window === 'undefined') return;\n\n        // Poll for changes every 5 seconds if connected\n        let pollInterval: NodeJS.Timeout | null = null;\n\n        if (walletState.isConnected) {\n            pollInterval = setInterval(async () => {\n                const currentAddress = await walletService.getConnectedAddress();\n                if (currentAddress !== walletState.address) {\n                    await refreshState();\n                }\n            }, 5000);\n        }\n\n        return () => {\n            if (pollInterval) {\n                clearInterval(pollInterval);\n            }\n        };\n    }, [walletState.isConnected, walletState.address, refreshState]);\n\n    /**\n     * Connect to the wallet\n     */\n    const connect = useCallback(async (): Promise<boolean> => {\n        setIsLoading(true);\n        setError(null);\n\n        try {\n            const result = await walletService.connect();\n\n            if (isWalletError(result)) {\n                setError(result);\n                setIsLoading(false);\n                return false;\n            }\n\n            // Successfully connected, refresh state\n            await refreshState();\n            setIsLoading(false);\n            return true;\n        } catch (err: any) {\n            console.error('Error connecting wallet:', err);\n            setError({\n                code: WalletErrorCode.UNKNOWN,\n                message: err.message || 'Failed to connect wallet',\n            });\n            setIsLoading(false);\n            return false;\n        }\n    }, [refreshState]);\n\n    /**\n     * Disconnect from the wallet (client-side only, doesn't revoke permission)\n     */\n    const disconnect = useCallback(() => {\n        setWalletState({\n            ...walletState,\n            isConnected: false,\n            address: null,\n        });\n        setError(null);\n    }, [walletState]);\n\n    /**\n     * Sign an authorization entry\n     */\n    const signAuthEntry = useCallback(\n        async (authEntryPreimageXdr: string): Promise<SignAuthEntryResult | WalletError> => {\n            if (!walletState.isConnected || !walletState.address) {\n                return {\n                    code: WalletErrorCode.NOT_ALLOWED,\n                    message: 'Wallet not connected',\n                };\n            }\n\n            return walletService.signAuthEntry(authEntryPreimageXdr, walletState.address);\n        },\n        [walletState.isConnected, walletState.address]\n    );\n\n    /**\n     * Format address for display (truncate middle)\n     */\n    const formatAddress = useCallback((address: string): string => {\n        if (!address || address.length < 10) return address;\n        return `${address.slice(0, 4)}...${address.slice(-4)}`;\n    }, []);\n\n    /**\n     * Check if connected to testnet\n     */\n    const isTestnet = useCallback((): boolean => {\n        if (!walletState.network) return false;\n        return walletState.network.network === 'TESTNET' ||\n            walletState.network.networkPassphrase.includes('Test SDF Network');\n    }, [walletState.network]);\n\n    const value: WalletContextType = {\n        walletState,\n        isLoading,\n        error,\n        connect,\n        disconnect,\n        refreshState,\n        signAuthEntry,\n        formatAddress,\n        isTestnet,\n    };\n\n    return <WalletContext.Provider value={value}>{children}</WalletContext.Provider>;\n}\n\n// ==================== HOOK ====================\n\nexport function useWallet(): WalletContextType {\n    const context = useContext(WalletContext);\n    if (context === undefined) {\n        throw new Error('useWallet must be used within a WalletProvider');\n    }\n    return context;\n}\n\n// ==================== UTILITY COMPONENTS ====================\n\ninterface ConnectWalletButtonProps {\n    className?: string;\n    onConnect?: () => void;\n    onError?: (error: WalletError) => void;\n}\n\nexport function ConnectWalletButton({ className = '', onConnect, onError }: ConnectWalletButtonProps) {\n    const { walletState, isLoading, error, connect, disconnect, formatAddress } = useWallet();\n\n    const handleClick = async () => {\n        if (walletState.isConnected) {\n            disconnect();\n        } else {\n            const success = await connect();\n            if (success) {\n                onConnect?.();\n            } else if (error) {\n                onError?.(error);\n            }\n        }\n    };\n\n    if (!walletState.isInstalled) {\n        return (\n            <a\n                href=\"https://freighter.app\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className={`inline-flex items-center gap-2 px-4 py-2 bg-white text-black rounded-lg font-medium text-sm hover:bg-white/90 transition-colors ${className}`}\n            >\n                <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\n                </svg>\n                Install Freighter\n            </a>\n        );\n    }\n\n    if (walletState.isConnected && walletState.address) {\n        return (\n            <div className=\"flex items-center gap-3\">\n                <div className=\"flex items-center gap-2 px-3 py-2 bg-white/5 rounded-lg border border-white/10\">\n                    <div className=\"w-2 h-2 rounded-full bg-green-500\" />\n                    <span className=\"text-sm text-white/80 font-mono\">\n                        {formatAddress(walletState.address)}\n                    </span>\n                </div>\n                <button\n                    onClick={handleClick}\n                    className=\"px-3 py-2 text-sm text-white/50 hover:text-white transition-colors\"\n                >\n                    Disconnect\n                </button>\n            </div>\n        );\n    }\n\n    return (\n        <button\n            onClick={handleClick}\n            disabled={isLoading}\n            className={`inline-flex items-center gap-2 px-4 py-2 bg-white text-black rounded-lg font-medium text-sm hover:bg-white/90 transition-colors disabled:opacity-50 ${className}`}\n        >\n            {isLoading ? (\n                <>\n                    <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n                    </svg>\n                    Connecting...\n                </>\n            ) : (\n                'Connect Wallet'\n            )}\n        </button>\n    );\n}\n\n// Network badge component\nexport function NetworkBadge() {\n    const { walletState, isTestnet } = useWallet();\n\n    if (!walletState.network) return null;\n\n    const isTest = isTestnet();\n\n    return (\n        <div className={`flex items-center gap-2 text-sm ${isTest ? 'text-yellow-400' : 'text-green-400'}`}>\n            <div className={`w-2 h-2 rounded-full ${isTest ? 'bg-yellow-500' : 'bg-green-500'} animate-pulse`} />\n            <span>{isTest ? 'Testnet' : 'Mainnet'}</span>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2527, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushalchaudhari/Desktop/Tesseract-Client/tesseract-client/app/batch-payments/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { lexendTera } from '../components/Fonts';\nimport RecipientsInput, { Recipient } from './components/RecipientsInput';\nimport AuthTreeVisualization from './components/AuthTreeVisualization';\nimport { SAFE_LIMITS, BulkPaymentService, PaymentRecipient } from '../services/bulkPaymentService';\nimport { WalletProvider, useWallet, ConnectWalletButton, NetworkBadge } from '../contexts/WalletContext';\nimport { isWalletError, WalletErrorCode } from '../services/walletService';\n\ntype TransactionState = 'idle' | 'preparing' | 'signing' | 'submitting' | 'success' | 'error';\n\ninterface TransactionStatus {\n    state: TransactionState;\n    message: string;\n    hash?: string;\n    error?: string | React.ReactNode;\n}\n\nfunction BatchPaymentsContent() {\n    const router = useRouter();\n    const { walletState, signAuthEntry, formatAddress, isTestnet } = useWallet();\n\n    const [recipients, setRecipients] = useState<Recipient[]>([\n        { id: '1', address: '', amount: '', isValid: false },\n    ]);\n    const [txStatus, setTxStatus] = useState<TransactionStatus>({\n        state: 'idle',\n        message: 'Ready to process payments',\n    });\n\n    // NEW: Track if visualization animation has completed\n    const [isVisualizationComplete, setIsVisualizationComplete] = useState(false);\n\n    // Callback when visualization finishes its completion animation\n    const handleVisualizationComplete = useCallback(() => {\n        setIsVisualizationComplete(true);\n    }, []);\n\n    // Compute valid recipients and batches\n    const validRecipients = useMemo(() => recipients.filter((r) => r.isValid), [recipients]);\n\n    const batchInfo = useMemo(() => {\n        const count = validRecipients.length;\n        if (count === 0) return [];\n\n        const batches = [];\n        for (let i = 0; i < count; i += SAFE_LIMITS.MAX_RECIPIENTS_PER_BATCH) {\n            batches.push({\n                workerIndex: batches.length,\n                recipientCount: Math.min(SAFE_LIMITS.MAX_RECIPIENTS_PER_BATCH, count - i),\n            });\n        }\n        return batches;\n    }, [validRecipients]);\n\n    const totalAmount = useMemo(() => {\n        return validRecipients.reduce((sum, r) => sum + parseFloat(r.amount), 0);\n    }, [validRecipients]);\n\n    // Execute batch payment\n    const executeBatchPayment = async () => {\n        // Reset visualization state for new transaction\n        setIsVisualizationComplete(false);\n\n        if (validRecipients.length === 0) {\n            setTxStatus({\n                state: 'error',\n                message: 'No valid recipients',\n                error: 'Add at least one valid recipient',\n            });\n            return;\n        }\n\n        if (!walletState.isConnected || !walletState.address) {\n            setTxStatus({\n                state: 'error',\n                message: 'Wallet not connected',\n                error: 'Please connect your Freighter wallet first',\n            });\n            return;\n        }\n\n        // Check network\n        if (!isTestnet()) {\n            setTxStatus({\n                state: 'error',\n                message: 'Wrong network',\n                error: 'Please switch to Stellar Testnet in Freighter',\n            });\n            return;\n        }\n\n        try {\n            setTxStatus({ state: 'preparing', message: 'Building authorization tree...' });\n\n            // Initialize the bulk payment service\n            const bulkPaymentService = new BulkPaymentService('testnet');\n\n            // Check if user account exists\n            const accountCheck = await bulkPaymentService.checkAccountExists(walletState.address);\n            if (!accountCheck.exists) {\n                setTxStatus({\n                    state: 'error',\n                    message: 'Account not funded',\n                    error: (\n                        <span>\n                            Your wallet address does not exist on Stellar Testnet. Please fund it using the Stellar{' '}\n                            <a\n                                href={`https://friendbot.stellar.org?addr=${walletState.address}`}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"underline hover:text-blue-300\"\n                            >\n                                Friendbot\n                            </a>\n                            .\n                        </span>\n                    ),\n                });\n                return;\n            }\n\n            // Convert recipients to PaymentRecipient format\n            const paymentRecipients: PaymentRecipient[] = validRecipients.map((r) => ({\n                address: r.address,\n                amount: BulkPaymentService.xlmToStroops(r.amount),\n            }));\n\n            // Validate and create batches\n            const batchResult = bulkPaymentService.validateAndCreateBatches(paymentRecipients);\n\n            if (batchResult.error || !batchResult.batches) {\n                setTxStatus({\n                    state: 'error',\n                    message: 'Validation failed',\n                    error: batchResult.error || 'Failed to create batches',\n                });\n                return;\n            }\n\n            // Build the authorization tree\n            const authTreeResult = await bulkPaymentService.buildAuthTree(\n                walletState.address,\n                batchResult.batches\n            );\n\n            setTxStatus({ state: 'signing', message: 'Awaiting wallet signature...' });\n\n            // Sign with Freighter using the preimage XDR (Freighter hashes it internally)\n            // Freighter returns the signature (signed hash), not a full auth entry\n            const signResult = await signAuthEntry(authTreeResult.authPreimageXdr);\n\n            if (isWalletError(signResult)) {\n                if (signResult.code === WalletErrorCode.USER_REJECTED) {\n                    setTxStatus({\n                        state: 'error',\n                        message: 'Signing cancelled',\n                        error: 'You cancelled the signing request',\n                    });\n                } else {\n                    setTxStatus({\n                        state: 'error',\n                        message: 'Signing failed',\n                        error: signResult.message,\n                    });\n                }\n                return;\n            }\n\n            setTxStatus({ state: 'submitting', message: 'Attaching signature and submitting...' });\n\n            // Freighter returns the signature as base64 - decode it\n            // Use atob for browser compatibility, then convert to Buffer for the SDK\n            const binaryString = atob(signResult.signedAuthEntry);\n            const signatureBytes = new Uint8Array(binaryString.length);\n            for (let i = 0; i < binaryString.length; i++) {\n                signatureBytes[i] = binaryString.charCodeAt(i);\n            }\n            const signatureBuffer = Buffer.from(signatureBytes);\n\n            // Attach the signature to the auth entry\n            const signedAuthEntry = await bulkPaymentService.signAuthEntry(\n                authTreeResult.authEntry,\n                walletState.address,\n                async () => signatureBuffer, // Return the signature we already have\n                authTreeResult.authPayload\n            );\n\n            // Get service account secret key from environment\n            // âš ï¸ WARNING: This is insecure and only for testnet/development\n            const serviceSecretKey = process.env.NEXT_PUBLIC_SERVICE_SECRET_KEY;\n\n            if (!serviceSecretKey) {\n                setTxStatus({\n                    state: 'error',\n                    message: 'Configuration error',\n                    error: 'Service account key not configured. Set NEXT_PUBLIC_SERVICE_SECRET_KEY in .env.local',\n                });\n                return;\n            }\n\n            // Submit the transaction to the network\n            const txResult = await bulkPaymentService.submitTransaction(\n                signedAuthEntry,\n                serviceSecretKey\n            );\n\n            if (txResult.success) {\n                setTxStatus({\n                    state: 'success',\n                    message: `Payment successful! ${batchResult.stats?.totalRecipients} recipients paid.`,\n                    hash: txResult.hash,\n                });\n            } else {\n                setTxStatus({\n                    state: 'error',\n                    message: 'Transaction failed',\n                    error: txResult.error || 'Unknown error during submission',\n                });\n            }\n\n        } catch (error: any) {\n            console.error('Batch payment error:', error);\n            setTxStatus({\n                state: 'error',\n                message: 'Transaction failed',\n                error: error.message || 'Unknown error occurred',\n            });\n        }\n    };\n\n    // Reset transaction\n    const resetTransaction = () => {\n        setTxStatus({ state: 'idle', message: 'Ready to process payments' });\n        setIsVisualizationComplete(false);\n    };\n\n    // Determine if actively processing (transaction in progress OR waiting for visualization to complete)\n    const isTransactionInProgress = ['preparing', 'signing', 'submitting'].includes(txStatus.state);\n\n    // Button shows loading until BOTH transaction completes AND visualization animation finishes\n    // This ensures synchronized completion experience\n    const isProcessing = isTransactionInProgress ||\n        (txStatus.state === 'success' );\n\n    const canSubmit = validRecipients.length > 0 && walletState.isConnected && !isProcessing;\n\n    return (\n        <div className=\"min-h-screen bg-black text-white\">\n            {/* Navigation */}\n            <nav className=\"w-full flex items-center justify-between py-6 px-8 lg:px-16 fixed top-0 left-0 z-50 bg-black/80 backdrop-blur-lg border-b border-white/5\">\n                <div className=\"flex items-center gap-x-4\">\n                    <button\n                        onClick={() => router.push('/dashboard')}\n                        className=\"flex items-center gap-2 text-white/60 hover:text-white transition-colors\"\n                    >\n                        <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n                        </svg>\n                        Back\n                    </button>\n                    <div className=\"w-px h-6 bg-white/20\" />\n                    <a href=\"/\" className=\"text-white/80 hover:text-white transition-colors flex items-center\">\n                        <img src=\"/Tess_BW.svg\" alt=\"Tesseract\" className=\"h-7 w-7 inline-block mr-2\" />\n                        <span className=\"hidden sm:inline\">TESSERACT</span>\n                    </a>\n                </div>\n\n                {/* Wallet Connection */}\n                <div className=\"flex items-center gap-4\">\n                    <NetworkBadge />\n                    <ConnectWalletButton />\n                </div>\n            </nav>\n\n            {/* Main Content */}\n            <div className=\"pt-24 pb-12 px-8 lg:px-16\">\n                {/* Header */}\n                <div className=\"max-w-6xl mx-auto mb-8\">\n                    <h1 className={`text-3xl lg:text-4xl font-bold mb-2 ${lexendTera.className}`}>\n                        Batch Payments\n                    </h1>\n                    <p className=\"text-white/60\">\n                        Pay up to {SAFE_LIMITS.MAX_TOTAL_RECIPIENTS} recipients with a single signature\n                    </p>\n                </div>\n\n                {/* Freighter Not Installed Warning */}\n                {!walletState.isInstalled && (\n                    <div className=\"max-w-6xl mx-auto mb-8 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl\">\n                        <div className=\"flex items-center gap-3\">\n                            <svg className=\"w-5 h-5 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                            </svg>\n                            <div>\n                                <p className=\"text-yellow-200 font-medium\">Freighter Wallet Required</p>\n                                <p className=\"text-yellow-200/70 text-sm\">\n                                    Install the{' '}\n                                    <a\n                                        href=\"https://freighter.app\"\n                                        target=\"_blank\"\n                                        rel=\"noopener noreferrer\"\n                                        className=\"underline hover:text-yellow-100\"\n                                    >\n                                        Freighter browser extension\n                                    </a>{' '}\n                                    to use batch payments.\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* Content Grid */}\n                <div className=\"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                    {/* Left Column - Recipients Input */}\n                    <div className=\"space-y-6\">\n                        <div className=\"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6\">\n                            <h2 className=\"text-lg font-semibold mb-4\">Recipients</h2>\n                            <RecipientsInput\n                                recipients={recipients}\n                                onRecipientsChange={setRecipients}\n                                disabled={isProcessing}\n                            />\n                        </div>\n\n                        {/* Payment Summary */}\n                        {validRecipients.length >0 && <div className=\"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6\">\n                            <h2 className=\"text-lg font-semibold mb-4\">Payment Summary</h2>\n                            <div className=\"space-y-4\">\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"text-white/60\">Recipients</span>\n                                    <span className=\"font-medium\">{validRecipients.length}</span>\n                                </div>\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"text-white/60\">Batches</span>\n                                    <span className=\"font-medium\">{batchInfo.length}</span>\n                                </div>\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"text-white/60\">Total Amount</span>\n                                    <span className=\"font-medium\">{totalAmount.toFixed(7)} XLM</span>\n                                </div>\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"text-white/60\">Signatures Required</span>\n                                    <span className=\"font-medium text-green-400\">1</span>\n                                </div>\n                                <div className=\"h-px bg-white/10\" />\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"text-white/60\">Estimated Fee</span>\n                                    <span className=\"font-medium text-white/80\">~0.01 XLM</span>\n                                </div>\n                                {walletState.address && (\n                                    <>\n                                        <div className=\"h-px bg-white/10\" />\n                                        <div className=\"flex justify-between items-center\">\n                                            <span className=\"text-white/60\">From</span>\n                                            <span className=\"font-mono text-sm text-white/80\">\n                                                {formatAddress(walletState.address)}\n                                            </span>\n                                        </div>\n                                    </>\n                                )}\n                            </div>\n                        </div>}\n\n                        {/* Action Button */}\n                        <button\n                            onClick={executeBatchPayment}\n                            disabled={!canSubmit}\n                            className={`w-full py-4 rounded-xl font-medium text-lg transition-all ${\n                                canSubmit\n                                    ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white hover:opacity-90'\n                                    : 'bg-white/10 text-white/40 cursor-not-allowed'\n                            }`}\n                        >\n                            {isProcessing ? (\n                                <span className=\"flex items-center justify-center gap-2\">\n                                    <svg className=\"w-5 h-5 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n                                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n                                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n                                    </svg>\n                                    {txStatus.state === 'success' \n                                        ? 'Completing...'\n                                        : txStatus.message}\n                                </span>\n                            ) : !walletState.isConnected ? (\n                                'Connect Wallet to Continue'\n                            ) : validRecipients.length === 0 ? (\n                                'Add Recipients to Continue'\n                            ) : (\n                                `Pay ${validRecipients.length} Recipients`\n                            )}\n                        </button>\n\n                        {/* Status Message */}\n                        {txStatus.state !== 'idle' && (\n                            <div\n                                className={`p-4 rounded-xl border ${\n                                    txStatus.state === 'error'\n                                        ? 'bg-red-500/10 border-red-500/20'\n                                        : txStatus.state === 'success'\n                                        ? 'bg-green-500/10 border-green-500/20'\n                                        : 'bg-blue-500/10 border-blue-500/20'\n                                }`}\n                            >\n                                <div className=\"flex items-center gap-2\">\n                                    {txStatus.state === 'success' && (\n                                        <svg className=\"w-5 h-5 text-green-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                            <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                                        </svg>\n                                    )}\n                                    {txStatus.state === 'error' && (\n                                        <svg className=\"w-5 h-5 text-red-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                            <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                                        </svg>\n                                    )}\n                                    <span\n                                        className={\n                                            txStatus.state === 'error'\n                                                ? 'text-red-400'\n                                                : txStatus.state === 'success'\n                                                ? 'text-green-400'\n                                                : 'text-blue-400'\n                                        }\n                                    >\n                                        {txStatus.message}\n                                    </span>\n                                </div>\n                                {txStatus.error && (\n                                    <p className=\"mt-2 text-sm text-white/50\">{txStatus.error}</p>\n                                )}\n                                {txStatus.hash && txStatus.state === 'success' && (\n                                    <div className=\"mt-3\">\n                                        <a\n                                            href={`https://stellar.expert/explorer/testnet/tx/${txStatus.hash}`}\n                                            target=\"_blank\"\n                                            rel=\"noopener noreferrer\"\n                                            className=\"text-sm text-blue-400 hover:text-blue-300 font-mono break-all\"\n                                        >\n                                            View on Stellar Expert â†’\n                                        </a>\n                                        <p className=\"text-xs text-white/40 mt-2 font-mono\">\n                                            TX: {txStatus.hash}\n                                        </p>\n                                    </div>\n                                )}\n                                {(txStatus.state === 'error' || txStatus.state === 'success') && (\n                                    <button\n                                        onClick={resetTransaction}\n                                        className=\"mt-3 text-sm text-white/50 hover:text-white\"\n                                    >\n                                        {txStatus.state === 'success' ? 'New Payment' : 'Try Again'}\n                                    </button>\n                                )}\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Right Column - Auth Tree Visualization */}\n                    <div className=\"space-y-6\">\n                        <AuthTreeVisualization\n                            batches={batchInfo}\n                            isProcessing={isTransactionInProgress}\n                            isComplete={txStatus.state === 'success'}\n                            transactionHash={txStatus.hash}\n                            transactionState={txStatus.state}\n                            onVisualizationComplete={handleVisualizationComplete}\n                        />\n\n                        {/* How It Works */}\n                        <div className=\"bg-black/40 backdrop-blur-lg rounded-2xl border border-white/10 p-6\">\n                            <h3 className=\"text-lg font-semibold mb-4\">How It Works</h3>\n                            <div className=\"space-y-4\">\n                                <div className=\"flex gap-3\">\n                                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs text-blue-400\">\n                                        1\n                                    </div>\n                                    <div>\n                                        <div className=\"font-medium text-sm\">Add Recipients</div>\n                                        <div className=\"text-xs text-white/50\">\n                                            Upload a CSV or manually enter up to {SAFE_LIMITS.MAX_TOTAL_RECIPIENTS} recipients\n                                        </div>\n                                    </div>\n                                </div>\n                                <div className=\"flex gap-3\">\n                                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs text-blue-400\">\n                                        2\n                                    </div>\n                                    <div>\n                                        <div className=\"font-medium text-sm\">Build Auth Tree</div>\n                                        <div className=\"text-xs text-white/50\">\n                                            Recipients are split into batches of {SAFE_LIMITS.MAX_RECIPIENTS_PER_BATCH} for optimal processing\n                                        </div>\n                                    </div>\n                                </div>\n                                <div className=\"flex gap-3\">\n                                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs text-blue-400\">\n                                        3\n                                    </div>\n                                    <div>\n                                        <div className=\"font-medium text-sm\">Sign with Freighter</div>\n                                        <div className=\"text-xs text-white/50\">\n                                            One signature authorizes all payments atomically\n                                        </div>\n                                    </div>\n                                </div>\n                                <div className=\"flex gap-3\">\n                                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center text-xs text-green-400\">\n                                        4\n                                    </div>\n                                    <div>\n                                        <div className=\"font-medium text-sm\">Execute</div>\n                                        <div className=\"text-xs text-white/50\">\n                                            All payments succeed or fail together in one transaction\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Limits Info */}\n                        <div className=\"bg-white/5 rounded-xl p-4\">\n                            <h4 className=\"text-sm font-medium mb-3\">Current Limits</h4>\n                            <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                                <div className=\"flex justify-between\">\n                                    <span className=\"text-white/50\">Max Recipients</span>\n                                    <span>{SAFE_LIMITS.MAX_TOTAL_RECIPIENTS}</span>\n                                </div>\n                                <div className=\"flex justify-between\">\n                                    <span className=\"text-white/50\">Per Batch</span>\n                                    <span>{SAFE_LIMITS.MAX_RECIPIENTS_PER_BATCH}</span>\n                                </div>\n                                <div className=\"flex justify-between\">\n                                    <span className=\"text-white/50\">Max Batches</span>\n                                    <span>{SAFE_LIMITS.MAX_BATCHES}</span>\n                                </div>\n                                <div className=\"flex justify-between\">\n                                    <span className=\"text-white/50\">Network</span>\n                                    <span className=\"text-yellow-400\">Testnet</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Footer */}\n            <footer className=\"border-t border-white/10 py-6 px-8 lg:px-16\">\n                <div className=\"max-w-6xl mx-auto flex items-center justify-between text-sm text-white/40\">\n                    <span>Powered by Stellar Soroban</span>\n                    <span>Tesseract - 4D Privacy on 2D Ledger</span>\n                </div>\n            </footer>\n        </div>\n    );\n}\n\n// Wrap with WalletProvider\nexport default function BatchPayments() {\n    return (\n        <WalletProvider>\n            <BatchPaymentsContent />\n        </WalletProvider>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}