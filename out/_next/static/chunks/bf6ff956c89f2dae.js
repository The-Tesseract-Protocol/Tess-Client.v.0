(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,49500,e=>{"use strict";var t=e.i(67034);e.i(47167);var r=e.i(43476),s=e.i(71645),a=e.i(18566),n=e.i(13172);let i={TESTNET:{RPC_URL:"https://soroban-testnet.stellar.org",HORIZON_URL:"https://horizon-testnet.stellar.org",NETWORK_PASSPHRASE:n.Networks.TESTNET,ORCHESTRATOR_CONTRACT:"CBYD7XCJH6RCA27AXXJDO3ARZHQJIW5BYEHAUKJ7QS6NQMLIQ2KMJ3K2",XLM_SAC:"CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC"},MAINNET:{RPC_URL:"https://soroban-rpc.stellar.org",HORIZON_URL:"https://horizon.stellar.org",NETWORK_PASSPHRASE:n.Networks.PUBLIC,ORCHESTRATOR_CONTRACT:"",XLM_SAC:"CAS3J7GYLGXMF6TDJBBYYSE3HQ6BBSMLNUQ34T6TZMYMW2EVH34XOWMA"}},l={worker1:"CA46744JXE6PUFP2E4G26QKBG3DTA3RIGGWGTP2QIEKZ6U3CQ3LKM7SH",worker2:"CAWHF5NQMVED6ANSUMG3OXEMWQHOX2K53VSOK5FO3MMMG7Y5YMFMZABZ",worker3:"CC6VG5BLTU4SIZQAFOQZOIOEKLQAR2NYTMPOLZVULK7ZHYUTE7YKORPJ",worker4:"CCOV6M4AEP7TGZ3NIMFGUXMWO3TXSWHSHDGGMIYNN7QM2COM7ITEJBMU",worker5:"CDWIM6L5FKT3PQ7PCM5UFUIWPS22YVQWUMIMPKLPKBVFUKD5JJUQNH27",worker6:"CD236CW2YLUXXWK4WT6BRDKMDDCKZKPU5RJRSVL64H6XZLXEU3UZ73GF",worker7:"CB7O7WGBXMVGES75LSLVC277YIHVHGO75RN7YJELE7IQ2664TMZ4OLG6",worker8:"CBAUCRBOPXN33TIUIMBCQ2BPWPA446IWMK32KYO43RGOLG3KPBE3L5J2",worker9:"CCM6WJHG6CDN7YCR4BVSFKJVQEOW5BA6IHH6RSXX5QRPLNS7E4UL4SLN",worker10:"CBHRLC3IY6OIOGTU4E737IKPWV46N43NLTJX2ZIYGK7ZI6B4TRL7HIIC",worker11:"CC6N434Q5GH4TIN4NVXK7FWZHLEAAC3MIZATRHT3YK2VEAVK3GKW62CE",worker12:"CBGMTVKUULAVZ3UJQMJ74SISODP5FV5W2UGSWXHYGXUAYGLMXTM3QKHH",worker13:"CBCWTKVJEVDNYLMK7PD5VU67IX46BPCSOH75EINCF4MIYJW7HUF2O7P6",worker14:"CCNZ753NQBP67AZSYCQNLCVW56ZAY36AQMTNOBI2WKLP4GNR5ARBRIES",worker15:"CAEPOYMB33T6MQXNA2C5HLXNCKHLC5RCMF7EFCMPB3M2764RRUACC2E6",worker16:"CCJYOSKABCA4XDATIPB4BJI63GQ25AMGXFQSY6KSZ3AMCWAD6OF4L3RW",worker17:"CBEJCOJBK5QWHSOPLZY6OGY2446JXC5UJG2565NAQNP2BBY3WSRWZD57",worker18:"CB2TXKCIFCITSG4QICQAWJ4GPVJ6YBVBKBPTEAA5IDHL2QKHZ7FCLGNK",worker19:"CCTMP2VNVVSABI7J2L442KTBLRHYAMVIB632UTBZYZDMV3RIGU4OUBBY",worker20:"CBFYQMR7BY7CANCIWJEAL7LYVURWUIKZZZFM3FR2B765HZKTGYLEYLWW"};class o{server;networkPassphrase;orchestratorContract;xlmSac;workerContracts;constructor(e="testnet"){const t="mainnet"===e?i.MAINNET:i.TESTNET;this.server=new n.rpc.Server(t.RPC_URL,{allowHttp:!0}),this.networkPassphrase=t.NETWORK_PASSPHRASE,this.orchestratorContract=t.ORCHESTRATOR_CONTRACT,this.xlmSac=t.XLM_SAC,this.workerContracts=Object.values(l)}validateAndCreateBatches(e){if(0===e.length)return{error:"No recipients provided"};if(e.length>80)return{error:`Maximum 80 recipients per transaction. You provided ${e.length}.`};for(let t=0;t<e.length;t++){let r=e[t];if(!r.address||56!==r.address.length||!r.address.startsWith("G"))return{error:`Invalid Stellar address at row ${t+1}: ${r.address}`};if(r.amount<=0n)return{error:`Amount must be positive at row ${t+1}`}}let t=[],r=[];for(let s=0;s<e.length;s+=19){let a=e.slice(s,s+19),n=t.length%this.workerContracts.length;t.push({workerContractId:this.workerContracts[n],recipients:a.map(e=>e.address),amounts:a.map(e=>e.amount)}),r.push(a.length)}let s=e.reduce((e,t)=>e+t.amount,0n);return{batches:t,stats:{totalRecipients:e.length,totalAmount:s,batchCount:t.length,recipientsPerBatch:r}}}async buildAuthTree(e,r){let s=(await this.server.getLatestLedger()).sequence,a=s+1e3,i=BigInt(s),l=r.map(t=>{let r=t.recipients.map((r,s)=>new n.xdr.SorobanAuthorizedInvocation({function:n.xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(new n.xdr.InvokeContractArgs({contractAddress:new n.Address(this.xlmSac).toScAddress(),functionName:"transfer",args:[new n.Address(e).toScVal(),new n.Address(r).toScVal(),(0,n.nativeToScVal)(t.amounts[s],{type:"i128"})]})),subInvocations:[]}));return new n.xdr.SorobanAuthorizedInvocation({function:n.xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(new n.xdr.InvokeContractArgs({contractAddress:new n.Address(t.workerContractId).toScAddress(),functionName:"batch_pay",args:[new n.Address(e).toScVal(),n.xdr.ScVal.scvVec(t.recipients.map(e=>new n.Address(e).toScVal())),n.xdr.ScVal.scvVec(t.amounts.map(e=>(0,n.nativeToScVal)(e,{type:"i128"}))),new n.Address(this.xlmSac).toScVal()]})),subInvocations:r})}),o=n.xdr.ScVal.scvVec(r.map(e=>n.xdr.ScVal.scvMap([new n.xdr.ScMapEntry({key:n.xdr.ScVal.scvSymbol("amounts"),val:n.xdr.ScVal.scvVec(e.amounts.map(e=>(0,n.nativeToScVal)(e,{type:"i128"})))}),new n.xdr.ScMapEntry({key:n.xdr.ScVal.scvSymbol("recipients"),val:n.xdr.ScVal.scvVec(e.recipients.map(e=>new n.Address(e).toScVal()))}),new n.xdr.ScMapEntry({key:n.xdr.ScVal.scvSymbol("worker_contract"),val:new n.Address(e.workerContractId).toScVal()})]))),c=new n.xdr.SorobanAuthorizedInvocation({function:n.xdr.SorobanAuthorizedFunction.sorobanAuthorizedFunctionTypeContractFn(new n.xdr.InvokeContractArgs({contractAddress:new n.Address(this.orchestratorContract).toScAddress(),functionName:"orchestrate_payments",args:[new n.Address(e).toScVal(),o,new n.Address(this.xlmSac).toScVal()]})),subInvocations:l}),d=new n.xdr.SorobanAuthorizationEntry({credentials:n.xdr.SorobanCredentials.sorobanCredentialsAddress(new n.xdr.SorobanAddressCredentials({address:new n.Address(e).toScAddress(),nonce:n.xdr.Int64.fromString(i.toString()),signatureExpirationLedger:a,signature:n.xdr.ScVal.scvVoid()})),rootInvocation:c}),h=(0,n.hash)(t.Buffer.from(this.networkPassphrase)),u=n.xdr.HashIdPreimage.envelopeTypeSorobanAuthorization(new n.xdr.HashIdPreimageSorobanAuthorization({networkId:h,nonce:n.xdr.Int64.fromString(i.toString()),signatureExpirationLedger:a,invocation:c})).toXDR(),x=u.toString("base64");return{authEntry:d,authPayload:(0,n.hash)(u),authPreimageXdr:x,expirationLedger:a,nonce:i}}async signAuthEntry(e,t,r,s){let a=await r(s),i=n.xdr.ScVal.scvVec([n.xdr.ScVal.scvMap([new n.xdr.ScMapEntry({key:n.xdr.ScVal.scvSymbol("public_key"),val:n.xdr.ScVal.scvBytes(n.Keypair.fromPublicKey(t).rawPublicKey())}),new n.xdr.ScMapEntry({key:n.xdr.ScVal.scvSymbol("signature"),val:n.xdr.ScVal.scvBytes(a)})])]),l=e.credentials().address(),o=n.xdr.SorobanCredentials.sorobanCredentialsAddress(new n.xdr.SorobanAddressCredentials({address:l.address(),nonce:l.nonce(),signatureExpirationLedger:l.signatureExpirationLedger(),signature:i}));return new n.xdr.SorobanAuthorizationEntry({credentials:o,rootInvocation:e.rootInvocation()})}async submitTransaction(e,t){let r,s=n.Keypair.fromSecret(t),a=s.publicKey();console.log("=== Submit Transaction Debug ==="),console.log("Service address:",a),console.log("Orchestrator contract:",this.orchestratorContract),console.log("XLM SAC:",this.xlmSac);try{r=await this.server.getAccount(a)}catch(e){return{success:!1,error:`Failed to load service account: ${a}. Ensure it is funded.`}}let i=e.rootInvocation().function().contractFn(),l=n.xdr.HostFunction.hostFunctionTypeInvokeContract(i),o=n.Operation.invokeHostFunction({func:l,auth:[e]}),c=new n.TransactionBuilder(r,{fee:"100",networkPassphrase:this.networkPassphrase}).addOperation(o).setTimeout(60).build(),d=await this.server.simulateTransaction(c);if(n.rpc.Api.isSimulationError(d)){console.error("=== Simulation Error ==="),console.error("Error:",d.error),console.error("Full response:",JSON.stringify(d,null,2));let e=d.error||"Unknown simulation error";return{success:!1,error:`Simulation failed: ${e}`}}let h=d.transactionData?.build(),u=Math.ceil(2*parseInt(d.minResourceFee||"0"));r=await this.server.getAccount(a);let x=new n.TransactionBuilder(r,{fee:u.toString(),networkPassphrase:this.networkPassphrase}).setSorobanData(h).addOperation(o).setTimeout(90).build();x.sign(s);let m=await this.server.sendTransaction(x);if("PENDING"!==m.status)return{success:!1,error:`Transaction submission failed. Status: ${m.status}`};let p=await this.server.getTransaction(m.hash),g=0;for(;"NOT_FOUND"===p.status&&g<30;)await new Promise(e=>setTimeout(e,1e3)),p=await this.server.getTransaction(m.hash),g++;return"SUCCESS"===p.status?{success:!0,hash:m.hash,ledger:p.ledger}:{success:!1,error:`Transaction failed with status: ${p.status}`,hash:m.hash}}async checkAccountExists(e){try{return await this.server.getAccount(e),{exists:!0}}catch(t){if(t.message?.includes("Not Found")||404===t.code)return{exists:!1,error:`Account ${e} does not exist on the network. Please fund it first.`};return{exists:!1,error:t.message||"An unknown error occurred while checking account existence."}}}static xlmToStroops(e){return BigInt(Math.floor(("string"==typeof e?parseFloat(e):e)*Number(10000000n)))}static stroopsToXlm(e){return(Number(e)/Number(10000000n)).toFixed(7)}static parseCSV(e){let t=e.trim().split("\n"),r=[],s=[],a=0,n=t[0].toLowerCase();(n.includes("address")||n.includes("recipient")||n.includes("amount"))&&(a=1);for(let e=a;e<t.length;e++){let a=t[e].trim();if(!a)continue;let n=a.split(",").map(e=>e.trim());if(n.length<2)return{error:`Invalid format at line ${e+1}: expected "address,amount"`};let i=n[0],l=n[1],c=parseFloat(l);if(isNaN(c)||c<=0)return{error:`Invalid amount at line ${e+1}: ${l}`};c<1e-7&&s.push(`Very small amount at line ${e+1}: ${l} XLM`),r.push({address:i,amount:o.xlmToStroops(c)})}return 0===r.length?{error:"No valid recipients found in CSV"}:{recipients:r,warnings:s}}getOrchestratorContract(){return this.orchestratorContract}getXlmSac(){return this.xlmSac}getServer(){return this.server}}function c({recipients:e,onRecipientsChange:t,disabled:a=!1}){let[n,i]=(0,s.useState)(!1),[l,o]=(0,s.useState)("manual"),c=(0,s.useRef)(null),d=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,h=(e,t)=>{if(!e.trim())return{isValid:!1,error:"Address required"};if(56!==e.length||!e.startsWith("G"))return{isValid:!1,error:"Invalid Stellar address"};let r=parseFloat(t);return isNaN(r)||r<=0?{isValid:!1,error:"Invalid amount"}:{isValid:!0}},u=(r,s,a)=>{t(e.map(e=>{if(e.id!==r)return e;let t=h("address"===s?a:e.address,"amount"===s?a:e.amount);return{...e,[s]:a,isValid:t.isValid,error:t.error}}))},x=(0,s.useCallback)(e=>{let r=new FileReader;r.onload=e=>{let r=(e.target?.result).trim().split("\n"),s=0,a=r[0].toLowerCase();(a.includes("address")||a.includes("recipient"))&&(s=1);let n=[];for(let e=s;e<r.length&&n.length<80;e++){let t=r[e].trim();if(!t)continue;let s=t.split(",").map(e=>e.trim());if(s.length>=2){let e=s[0],t=s[1],r=h(e,t);n.push({id:d(),address:e,amount:t,isValid:r.isValid,error:r.error})}}n.length>0&&(t(n),o("csv"))},r.readAsText(e)},[t]),m=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?i(!0):"dragleave"===e.type&&i(!1)},p=e.filter(e=>e.isValid).length,g=e.filter(e=>e.isValid).reduce((e,t)=>e+parseFloat(t.amount),0);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"flex bg-white/5 rounded-lg p-1",children:[(0,r.jsx)("button",{onClick:()=>o("manual"),className:`px-3 py-1.5 text-sm rounded-md transition-all ${"manual"===l?"bg-white/10 text-white":"text-white/50 hover:text-white"}`,disabled:a,children:"Manual Entry"}),(0,r.jsx)("button",{onClick:()=>c.current?.click(),className:`px-3 py-1.5 text-sm rounded-md transition-all ${"csv"===l?"bg-white/10 text-white":"text-white/50 hover:text-white"}`,disabled:a,children:"Upload CSV"})]})}),(0,r.jsxs)("div",{className:"text-sm text-white/50",children:[p,"/",80," recipients"]})]}),(0,r.jsxs)("div",{className:`relative border-2 border-dashed rounded-xl p-6 text-center transition-all ${n?"border-blue-500 bg-blue-500/10":"border-white/20 hover:border-white/30"} ${a?"opacity-50 pointer-events-none":""}`,onDragEnter:m,onDragLeave:m,onDragOver:m,onDrop:e=>{e.preventDefault(),e.stopPropagation(),i(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&x(e.dataTransfer.files[0])},children:[(0,r.jsx)("input",{ref:c,type:"file",accept:".csv,.txt",onChange:e=>e.target.files?.[0]&&x(e.target.files[0]),className:"hidden",disabled:a}),(0,r.jsx)("svg",{className:"w-10 h-10 mx-auto mb-3 text-white/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,r.jsxs)("p",{className:"text-sm text-white/60 mb-1",children:["Drag and drop CSV file here, or"," ",(0,r.jsx)("button",{onClick:()=>c.current?.click(),className:"text-blue-400 hover:text-blue-300",disabled:a,children:"browse"})]}),(0,r.jsx)("p",{className:"text-xs text-white/40",children:"Format: address,amount (amount in XLM)"})]}),(0,r.jsxs)("div",{className:"bg-black/20 rounded-xl border border-white/10 overflow-hidden",children:[(0,r.jsxs)("div",{className:"grid grid-cols-[1fr_120px_40px] gap-2 px-4 py-3 bg-white/5 border-b border-white/10",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-white/60 uppercase tracking-wider",children:"Recipient Address"}),(0,r.jsx)("div",{className:"text-xs font-medium text-white/60 uppercase tracking-wider",children:"Amount (XLM)"}),(0,r.jsx)("div",{})]}),(0,r.jsx)("div",{className:"h-[200px] overflow-y-auto",children:e.map((s,n)=>(0,r.jsxs)("div",{className:`grid grid-cols-[1fr_120px_40px] gap-2 px-4 py-2 border-b border-white/5 ${!s.isValid&&(s.address||s.amount)?"bg-red-500/5":""}`,children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",value:s.address,onChange:e=>u(s.id,"address",e.target.value),placeholder:"G...",className:`w-full bg-transparent border-0 text-sm font-mono text-white placeholder-white/30 focus:outline-none focus:ring-0 ${!s.isValid&&s.address?"text-red-400":""}`,disabled:a}),s.error&&s.address&&(0,r.jsx)("div",{className:"absolute -bottom-4 left-0 text-xs text-red-400",children:s.error})]}),(0,r.jsx)("input",{type:"number",step:"0.0000001",min:"0",value:s.amount,onChange:e=>u(s.id,"amount",e.target.value),placeholder:"0.00",className:"w-full bg-transparent border-0 text-sm text-white placeholder-white/30 focus:outline-none focus:ring-0",disabled:a}),(0,r.jsx)("button",{onClick:()=>{var r;return r=s.id,void(!(e.length<=1)&&t(e.filter(e=>e.id!==r)))},className:"flex items-center justify-center text-white/30 hover:text-red-400 transition-colors",disabled:a||e.length<=1,children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s.id))}),(0,r.jsx)("div",{className:"px-4 py-3 border-t border-white/10",children:(0,r.jsxs)("button",{onClick:()=>{e.length>=80||t([...e,{id:d(),address:"",amount:"",isValid:!1}])},disabled:a||e.length>=80,className:"flex items-center gap-2 text-sm text-white/50 hover:text-white transition-colors disabled:opacity-30",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Recipient"]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 p-4 bg-white/2 rounded-xl",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-white/40 mb-1",children:"Valid Recipients"}),(0,r.jsxs)("div",{className:"text-lg font-semibold text-white",children:[p,(0,r.jsxs)("span",{className:"text-sm text-white/40",children:["/",e.length]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-white/40 mb-1",children:"Total Amount"}),(0,r.jsxs)("div",{className:"text-lg font-semibold text-white",children:[g.toFixed(2),(0,r.jsx)("span",{className:"text-sm text-white/40",children:" XLM"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-white/40 mb-1",children:"Batches"}),(0,r.jsx)("div",{className:"text-lg font-semibold text-white",children:Math.ceil(p/19)||0})]})]}),e.length>=80&&(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[(0,r.jsx)("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,r.jsxs)("span",{className:"text-sm text-yellow-200",children:["Approaching limit: Maximum ",80," recipients per transaction"]})]}),e.length>1&&(0,r.jsx)("button",{onClick:()=>{t([{id:d(),address:"",amount:"",isValid:!1}]),o("manual")},disabled:a,className:"text-sm text-white/40 hover:text-white/80 transition-colors border border-white/10 px-3 py-1 rounded-lg hover:border-white/40",children:"Clear all recipients"})]})}function d(e){return 1-Math.pow(1-e,3)}function h({batches:e,isProcessing:t,isComplete:a,transactionHash:n,transactionState:i="idle",onVisualizationComplete:l}){let[o,c]=(0,s.useState)(0),[h,x]=(0,s.useState)("idle"),[m,p]=(0,s.useState)(!1),g=(0,s.useRef)(null),b=(0,s.useRef)(null),w=(0,s.useRef)(null),f=(0,s.useRef)(0),v=(0,s.useRef)("idle");e.map((e,t)=>{let r=Array.from({length:e.recipientCount},(e,r)=>({id:`transfer-${t}-${r}`,label:`Transfer ${r+1}`,type:"transfer",status:"pending"}));return{id:`worker-${t}`,label:`Worker ${t+1}`,type:"worker",children:r,status:"pending"}});let N=1+e.length+e.reduce((e,t)=>e+t.recipientCount,0),j=(0,s.useCallback)(e=>{switch(e){case"preparing":return{min:0,max:.3};case"signing":return{min:.3,max:.5};case"submitting":return{min:.5,max:.85};case"success":return{min:.85,max:1};default:return{min:0,max:0}}},[]),C=(0,s.useCallback)(()=>{if(!b.current)return;let e=Date.now()-b.current,t=j(i),r=Math.min(e/800,1),s=t.min+(t.max-t.min)*.9,n=t.min+(s-t.min)*d(r);c(e=>Math.max(e,n)),n<.3?x("building"):n<.5?x("signing"):n<.85&&x("submitting"),r<1&&!a&&(g.current=requestAnimationFrame(C))},[i,a,j]),S=(0,s.useCallback)(()=>{if(!w.current)return;let e=Math.min((Date.now()-w.current)/2e3,1),t=f.current,r=t+(1-t)*d(e);c(r),r<.95?x("submitting"):x("complete"),e<1?g.current=requestAnimationFrame(S):(p(!0),l?.())},[l]);(0,s.useEffect)(()=>{i!==v.current&&(g.current&&(cancelAnimationFrame(g.current),g.current=null),v.current=i,"preparing"===i?(b.current=Date.now(),x("building"),g.current=requestAnimationFrame(C)):"signing"===i?(b.current=Date.now(),x("signing"),c(e=>Math.max(e,.3)),g.current=requestAnimationFrame(C)):"submitting"===i?(b.current=Date.now(),x("submitting"),c(e=>Math.max(e,.5)),g.current=requestAnimationFrame(C)):"success"===i?(f.current=o,w.current=Date.now(),g.current=requestAnimationFrame(S)):"error"===i?x("idle"):"idle"===i&&(b.current=null,w.current=null,f.current=0,c(0),x("idle"),p(!1)))},[i,C,S,o]),(0,s.useEffect)(()=>()=>{g.current&&cancelAnimationFrame(g.current)},[]),(0,s.useEffect)(()=>{a&&"success"!==i&&!w.current&&(f.current=o,w.current=Date.now(),g.current=requestAnimationFrame(S))},[a,i,o,S]),(0,s.useEffect)(()=>{t||a||"idle"!==i||(b.current=null,w.current=null,f.current=0,c(0),x("idle"),p(!1))},[t,a,i]);let A=(e,t)=>{if(m||o>=.99)return"complete";let r=t/N;return o>=r+1/N?"complete":o>=r?"active":"pending"};return(0,r.jsxs)("div",{className:"bg-transparent backdrop-blur-lg rounded-2xl border border-white/5 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Authorization Tree"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["idle"!==h&&"complete"!==h&&(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500 animate-pulse"}),"complete"===h&&(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,r.jsx)("span",{className:"text-sm text-white/60",children:{idle:"Ready to process",building:"Building Authorization Tree...",signing:"Awaiting Signature...",submitting:"Submitting Transaction...",complete:"Transaction Complete"}[h]})]})]}),"idle"!==h&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("div",{className:"h-1 bg-white/10 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 ease-out",style:{width:`${100*o}%`}})})}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)(u,{label:"Orchestrator",sublabel:"orchestrate_payments()",status:A(0,1),isRoot:!0}),e.length>0&&(0,r.jsxs)("div",{className:"relative w-full mt-4 mb-4",children:[(0,r.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-px h-6 bg-white/5"}),(0,r.jsx)("div",{className:"absolute top-6 left-1/2 transform -translate-x-1/2 w-[80%] h-px bg-white/20"})]}),(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-4 w-full",children:e.map((t,s)=>{let a=1+s*(1+Math.max(...e.map(e=>e.recipientCount))),n=A(s+1,a/N);return(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-px h-4 bg-white/20"}),(0,r.jsx)(u,{label:`Worker ${s+1}`,sublabel:`batch_pay() - ${t.recipientCount} transfers`,status:n}),(0,r.jsx)("div",{className:"mt-3 flex flex-wrap justify-center gap-1 max-w-[120px]",children:Array.from({length:t.recipientCount},(e,t)=>{let s=a+1+t,n=A(s,s/N);return(0,r.jsx)("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${"complete"===n?"bg-green-500":"active"===n?"bg-blue-500 animate-pulse":"bg-white/20"}`,title:`Transfer ${t+1}`},t)})})]},s)})})]})}),(0,r.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10 grid grid-cols-3 gap-4 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-2xl font-semibold text-white",children:e.length}),(0,r.jsx)("div",{className:"text-xs text-white/40",children:"Batches"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-2xl font-semibold text-white",children:e.reduce((e,t)=>e+t.recipientCount,0)}),(0,r.jsx)("div",{className:"text-xs text-white/40",children:"Recipients"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-2xl font-semibold text-white",children:"1"}),(0,r.jsx)("div",{className:"text-xs text-white/40",children:"Signature"})]})]}),n&&"complete"===h&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:[(0,r.jsx)("div",{className:"text-xs text-green-400 mb-1",children:"Transaction Hash"}),(0,r.jsx)("div",{className:"text-sm text-white font-mono truncate",children:(0,r.jsx)("a",{href:`https://stellar.expert/explorer/testnet/tx/${n}`,target:"_blank",rel:"noopener noreferrer",className:"hover:text-blue-400 transition-colors",children:n})})]})]})}function u({label:e,sublabel:t,status:s,isRoot:a}){return(0,r.jsx)("div",{className:`relative px-4 py-3 rounded-xl border transition-all duration-300 ${{pending:"border-white/20 bg-black/40",active:"border-blue-500 bg-blue-500/10 shadow-lg shadow-blue-500/20",complete:"border-green-500 bg-green-500/10"}[s]} ${a?"min-w-[200px]":"min-w-[140px]"}`,children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:`transition-colors duration-300 ${{pending:"text-white/40",active:"text-blue-400",complete:"text-green-400"}[s]}`,children:"complete"===s?(0,r.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):"active"===s?(0,r.jsxs)("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,r.jsx)("div",{className:"w-4 h-4 rounded-full border border-current"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-white",children:e}),t&&(0,r.jsx)("div",{className:"text-xs text-white/40 font-mono",children:t})]})]})})}new o("testnet");var x=e.i(77223),m=e.i(77755),p=e.i(93947);function g(){let e=(0,a.useRouter)(),{walletState:n,signAuthEntry:i,formatAddress:l,isTestnet:d}=(0,x.useWallet)(),[u,g]=(0,s.useState)([{id:"1",address:"",amount:"",isValid:!1}]),[b,w]=(0,s.useState)({state:"idle",message:"Ready to process payments"}),[f,v]=(0,s.useState)(!1),N=(0,s.useCallback)(()=>{v(!0)},[]),j=(0,s.useMemo)(()=>u.filter(e=>e.isValid),[u]),C=(0,s.useMemo)(()=>{let e=j.length;if(0===e)return[];let t=[];for(let r=0;r<e;r+=19)t.push({workerIndex:t.length,recipientCount:Math.min(19,e-r)});return t},[j]),S=(0,s.useMemo)(()=>j.reduce((e,t)=>e+parseFloat(t.amount),0),[j]),A=async()=>{if(v(!1),0===j.length)return void w({state:"error",message:"No valid recipients",error:"Add at least one valid recipient"});if(!n.isConnected||!n.address)return void w({state:"error",message:"Wallet not connected",error:"Please connect your Freighter wallet first"});if(!d())return void w({state:"error",message:"Wrong network",error:"Please switch to Stellar Testnet in Freighter"});try{w({state:"preparing",message:"Building authorization tree..."});let e=new o("testnet");if(!(await e.checkAccountExists(n.address)).exists)return void w({state:"error",message:"Account not funded",error:(0,r.jsxs)("span",{children:["Your wallet address does not exist on Stellar Testnet. Please fund it using the Stellar"," ",(0,r.jsx)("a",{href:`https://friendbot.stellar.org?addr=${n.address}`,target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-blue-300",children:"Friendbot"}),"."]})});let s=j.map(e=>({address:e.address,amount:o.xlmToStroops(e.amount)})),a=e.validateAndCreateBatches(s);if(a.error||!a.batches)return void w({state:"error",message:"Validation failed",error:a.error||"Failed to create batches"});let l=await e.buildAuthTree(n.address,a.batches);w({state:"signing",message:"Awaiting wallet signature..."});let c=await i(l.authPreimageXdr);if((0,m.isWalletError)(c))return void(c.code===m.WalletErrorCode.USER_REJECTED?w({state:"error",message:"Signing cancelled",error:"You cancelled the signing request"}):w({state:"error",message:"Signing failed",error:c.message}));w({state:"submitting",message:"Attaching signature and submitting..."});let d=atob(c.signedAuthEntry),h=new Uint8Array(d.length);for(let e=0;e<d.length;e++)h[e]=d.charCodeAt(e);let u=t.Buffer.from(h),x=await e.signAuthEntry(l.authEntry,n.address,async()=>u,l.authPayload),p=await e.submitTransaction(x,"SDLLCGN5DWJGMRQTNIP5LKUIZNIIGK47C45MARZG5KD5A6D63V4WGFTR");p.success?w({state:"success",message:`Payment successful! ${a.stats?.totalRecipients} recipients paid.`,hash:p.hash}):w({state:"error",message:"Transaction failed",error:p.error||"Unknown error during submission"})}catch(e){console.error("Batch payment error:",e),w({state:"error",message:"Transaction failed",error:e.message||"Unknown error occurred"})}},y=()=>{w({state:"idle",message:"Ready to process payments"}),v(!1)},k=["preparing","signing","submitting"].includes(b.state),T=k||"success"===b.state&&!f,M=j.length>0&&n.isConnected&&!T;return(0,r.jsxs)("main",{className:"relative h-screen w-screen overflow-hidden bg-black",children:[(0,r.jsx)("div",{className:"absolute inset-0 z-0",children:(0,r.jsx)(p.default,{className:"h-full w-full",color:"#818cf8",trailOpacity:.1,speed:.8})}),(0,r.jsxs)("nav",{className:"absolute top-0 left-0 w-full flex items-center justify-between py-6 px-8 lg:px-16 z-50 bg-gradient-to-b from-black/80 to-transparent pointer-events-none",children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-4 pointer-events-auto",children:[(0,r.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"flex items-center gap-2 text-white/60 hover:text-white transition-colors bg-black/20 backdrop-blur-md px-4 py-2 rounded-full border border-white/5",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,r.jsxs)("a",{href:"/",className:"text-white/80 hover:text-white transition-colors flex items-center bg-black/20 backdrop-blur-md px-4 py-2 rounded-full border border-white/5",children:[(0,r.jsx)("img",{src:"/Tess-W.png",alt:"Tesseract",className:"h-7 w-7 inline-block mr-2"}),(0,r.jsx)("span",{className:"hidden sm:inline font-mono",children:"TESSERACT"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 pointer-events-auto",children:[(0,r.jsx)(x.NetworkBadge,{}),(0,r.jsx)(x.ConnectWalletButton,{})]})]}),(0,r.jsx)("div",{className:"absolute inset-0 z-10 pt-28 pb-4 px-4 overflow-y-auto scrollbar-hide",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("h1",{className:"text-3xl md:text-5xl font-bold tracking-tighter text-white drop-shadow-2xl",children:(0,r.jsx)("span",{className:"text-transparent bg-clip-text bg-gradient-to-b from-white to-white/60 font-mono",children:"Batch Payment"})}),(0,r.jsxs)("p",{className:"text-white/40 font-mono text-sm md:text-base",children:["Pay up to ",80," recipients with a single signature"]})]}),!n.isInstalled&&(0,r.jsx)("div",{className:"max-w-3xl mx-auto p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl backdrop-blur-md",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-yellow-200 font-medium",children:"Freighter Wallet Required"}),(0,r.jsxs)("p",{className:"text-yellow-200/70 text-sm",children:["Install the"," ",(0,r.jsx)("a",{href:"https://freighter.app",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-yellow-100",children:"View on Stellar Expert →"})]})]}),("error"===b.state||"success"===b.state)&&(0,r.jsx)("button",{onClick:y,className:"mt-3 text-sm text-white/50 hover:text-white",children:"success"===b.state?"New Payment":"Try Again"})]})}),(0,r.jsxs)("div",{className:"space-y-6 bg-gradient-to-br from-white/5 to-muted/10 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-6 bg-gradient-to-br from-white/5 to-muted/10 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[(0,r.jsxs)("div",{className:"backdrop-blur-lg rounded-2xl  p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Recipients"}),(0,r.jsx)(c,{recipients:u,onRecipientsChange:g,disabled:T})]}),j.length>0&&(0,r.jsxs)("div",{className:"bg-black/20 backdrop-blur-md rounded-3xl border border-white/10 p-6 shadow-xl space-y-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4 text-white/90",children:"Summary"}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-white/50",children:"Recipients"}),(0,r.jsx)("span",{className:"font-mono",children:j.length})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-white/50",children:"Batches"}),(0,r.jsx)("span",{className:"font-mono",children:C.length})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-white/50",children:"Total Amount"}),(0,r.jsxs)("span",{className:"font-mono text-indigo-400",children:[S.toFixed(7)," XLM"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-white/50",children:"Signatures"}),(0,r.jsx)("span",{className:"font-mono text-green-400",children:"1"})]}),(0,r.jsx)("div",{className:"h-px bg-white/5 my-2"}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,r.jsx)("span",{className:"text-white/40",children:"From"}),(0,r.jsx)("span",{className:"font-mono text-white/60 truncate max-w-[150px]",children:n.address?l(n.address):"-"})]})]})]}),(0,r.jsx)("button",{onClick:A,disabled:!M,className:`w-full py-4 rounded-2xl font-bold text-lg transition-all transform hover:scale-[1.01] active:scale-[0.99] shadow-lg ${M?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white hover:from-indigo-400 hover:to-purple-500":"bg-white/5 text-white/30 cursor-not-allowed border border-white/5"}`,children:T?(0,r.jsxs)("span",{className:"flex items-center justify-center gap-3",children:[(0,r.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"success"===b.state?"Completing...":b.message]}):n.isConnected?0===j.length?"Enter Recipients":`Pay ${j.length} Recipients`:"Connect Wallet"}),"idle"!==b.state&&(0,r.jsxs)("div",{className:`p-4 rounded-2xl border backdrop-blur-md ${"error"===b.state?"bg-red-500/10 border-red-500/20":"success"===b.state?"bg-green-500/10 border-green-500/20":"bg-indigo-500/10 border-indigo-500/20"}`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:["success"===b.state?(0,r.jsx)("svg",{className:"w-5 h-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):"error"===b.state?(0,r.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}):(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-indigo-400 animate-pulse"}),(0,r.jsx)("span",{className:`font-medium ${"error"===b.state?"text-red-400":"success"===b.state?"text-green-400":"text-indigo-400"}`,children:b.message})]}),b.error&&(0,r.jsx)("p",{className:"mt-2 text-sm text-white/50 pl-8",children:b.error}),b.hash&&"success"===b.state&&(0,r.jsx)("div",{className:"mt-3 pl-8",children:(0,r.jsx)("a",{href:`https://stellar.expert/explorer/testnet/tx/${b.hash}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-indigo-400 hover:text-indigo-300 font-mono underline decoration-indigo-400/30 underline-offset-2",children:"View on Stellar Expert"})}),("error"===b.state||"success"===b.state)&&(0,r.jsx)("button",{onClick:y,className:"mt-3 pl-8 text-xs text-white/40 hover:text-white transition-colors",children:"success"===b.state?"Start New Payment":"Dismiss"})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-black/20 backdrop-blur-md rounded-3xl border border-white/10 p-6 shadow-xl min-h-[400px]",children:(0,r.jsx)(h,{batches:C,isProcessing:k,isComplete:"success"===b.state,transactionHash:b.hash,transactionState:b.state,onVisualizationComplete:N})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"bg-black/20 backdrop-blur-md rounded-3xl border border-white/5 p-6",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold mb-4 text-white/80",children:"Process"}),(0,r.jsx)("div",{className:"space-y-4",children:[{id:1,title:"Input",text:"CSV or Manual"},{id:2,title:"Structure",text:"Auth Tree"},{id:3,title:"Sign",text:"Single Auth"},{id:4,title:"Exec",text:"Atomic"}].map(e=>(0,r.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,r.jsx)("div",{className:"w-5 h-5 rounded-full bg-indigo-500/20 flex items-center justify-center text-[10px] text-indigo-400 font-mono",children:e.id}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-medium text-white/70",children:e.title}),(0,r.jsx)("div",{className:"text-[10px] text-white/30",children:e.text})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"bg-black/20 backdrop-blur-md rounded-3xl border border-white/5 p-6",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold mb-4 text-white/80",children:"Limits"}),(0,r.jsxs)("div",{className:"space-y-3 text-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between py-1 border-b border-white/5",children:[(0,r.jsx)("span",{className:"text-white/40",children:"Max Recipients"}),(0,r.jsx)("span",{className:"font-mono text-white/70",children:80})]}),(0,r.jsxs)("div",{className:"flex justify-between py-1 border-b border-white/5",children:[(0,r.jsx)("span",{className:"text-white/40",children:"Per Batch"}),(0,r.jsx)("span",{className:"font-mono text-white/70",children:19})]}),(0,r.jsxs)("div",{className:"flex justify-between py-1 border-b border-white/5",children:[(0,r.jsx)("span",{className:"text-white/40",children:"Max Batches"}),(0,r.jsx)("span",{className:"font-mono text-white/70",children:5})]})]})]})]})]})]}),(0,r.jsx)("footer",{className:"py-8 text-center border-t border-white/5",children:(0,r.jsx)("p",{className:"text-xs text-white/20 font-mono",children:"Powered by Stellar Soroban • Uses Authorisation Trees for O(1) Signature Verification"})})]})]})})]})}function b(){return(0,r.jsx)(x.WalletProvider,{children:(0,r.jsx)(g,{})})}e.s(["default",()=>b],49500)}]);